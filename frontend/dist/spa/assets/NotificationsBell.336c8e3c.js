import{d as F,u as Z,a as J,r as T,h as c,i as k,j as v,t as m,g as e,k as n,w as i,n as A,ah as I,e as h,bW as Pe,o as d,f as _,p as we,q as g,a4 as Ye,H as X,bX as Ge,bY as je,az as w,c as He,ae as We,af as Xe,aj as ge,bZ as Ke,b_ as Ze,b$ as he,c0 as Je,aA as Ce,Q as Oe,b1 as et,b2 as tt,c1 as G,c2 as at,bE as Te,c3 as rt,c4 as Ne,c5 as ot,c6 as ke,ai as lt,c7 as st,c8 as nt,c9 as it,b7 as ut,b8 as dt,ca as ct,cb as mt,at as vt,au as pt,cc as ft,m as bt}from"./index.e78f07d2.js";import{a as yt,g as _t}from"./get-order-total-cost.c30b6c87.js";import{C as Q}from"./CommonTooltip.0edc01ee.js";import{_ as xe}from"./OrderNumberTitle.e800051e.js";import{_ as gt}from"./PaymentMethodsModal.a327a2c2.js";import{m as ht,f as M}from"./address.b5e3391c.js";import{g as K}from"./CommonFooter.d4a93731.js";import{a as j,Q as B,b as Ct}from"./QItemLabel.ded98037.js";import{Q as H}from"./QSelect.5cca8257.js";import{Q as Ie}from"./QInput.5e01f4a0.js";import{Q as Ot,_ as Ee}from"./NoData.bf12ea80.js";import{Q as Tt}from"./QImg.18303433.js";import{Q as Nt,o as kt}from"./on-form-validation-error.d7847268.js";import{u as It,C as W,B as St}from"./BigSpinner.12aaa730.js";import{_ as At}from"./AddAddressModal.3d09dd8e.js";import{_ as wt,g as xt}from"./get-order-type-icon.25344ebe.js";import{_ as Et}from"./OrderView.765dd0bc.js";import{_ as Dt}from"./PhoneInput.c9981377.js";import{c as Rt}from"./create-order.e1f65d8a.js";import{c as Se}from"./fuzzy-search.950e6fed.js";import{_ as Ae}from"./ConfirmDialog.b9893c8e.js";import{Q as Vt}from"./QMenu.e3114e00.js";const qt={class:"row no-wrap gap-md q-py-md q-px-xs items-center"},$t={class:"flex-grow"},Lt={class:"text-body2"},Bt={class:"text-subtitle1 text-weight-bold q-mb-xs"},Mt={key:0,class:"text-body2 q-mt-xs row no-wrap items-center gap-sm"},Qt={class:"text-weight-bold"},Ft={class:"q-mt-md row gap-sm justify-between"},Ut={key:1},zt={class:"text-body2 q-mb-sm"},Na=F({__name:"CookedOrderNotification",props:{order:{}},setup(u){const l=u,t=Z(),s=J(),f=T(!1),S=T(!1),x=c(()=>s.state.salePoints.defaultSalePoint),N=c(()=>{var p;return(p=s.state.auth.user.permissions)==null?void 0:p.client});function q(){var p,C;(C=window==null?void 0:window.open(`http://www.google.com/maps/place?q=${ht((p=x.value)==null?void 0:p.address)}`,"_blank"))==null||C.focus()}function U(){S.value=!0,s.commit.sync(Pe({orderId:l.order.order.id,isEmployee:!N.value})).finally(()=>{S.value=!1})}return(p,C)=>(d(),k("div",qt,[v("div",$t,[v("div",Lt,[v("p",Bt,m(N.value?e(t).clientOrderReady:e(t).employeeOrderReady),1),n(xe,{"order-number":p.order.order.orderNumber,"is-link":""},null,8,["order-number"]),x.value&&N.value?(d(),k("div",Mt,[v("div",null,[v("p",null,m(e(t).pickOrderUp),1),v("p",Qt,m(e(M)(x.value.address)),1)]),n(A,{round:"",dense:"",icon:"location_on",color:"primary",size:"md",onClick:q,title:e(t).showOnMap},{default:i(()=>[n(Q,null,{default:i(()=>[_(m(e(t).showOnMap),1)]),_:1})]),_:1},8,["title"])])):I("",!0)]),v("div",null,[v("div",Ft,[p.order.order.paidDate?(d(),k("div",Ut,[v("p",zt,m(N.value?e(t).orderReceiveInstruction:e(t).takeoutOrderDeliverInstruction),1),n(A,{color:"primary",onClick:U,loading:S.value},{default:i(()=>[_(m(N.value?e(t).confirmOrderReceived:e(t).delivered),1)]),_:1},8,["loading"])])):(d(),h(A,{key:0,color:"primary",onClick:C[0]||(C[0]=D=>f.value=!0)},{default:i(()=>[_(m(e(t).pay),1)]),_:1}))])])]),n(gt,{modelValue:f.value,"onUpdate:modelValue":C[1]||(C[1]=D=>f.value=D),"order-number":p.order.order.orderNumber,"order-id":p.order.order.id,"order-type":p.order.order.type,"total-cost":e(yt)(p.order.order)},null,8,["modelValue","order-number","order-id","order-type","total-cost"])]))}}),Pt=["top","middle","bottom"];var De=we({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:u=>Pt.includes(u)}},setup(u,{slots:l}){const t=c(()=>u.align!==void 0?{verticalAlign:u.align}:null),s=c(()=>{const f=u.outline===!0&&u.color||u.textColor;return`q-badge flex inline items-center no-wrap q-badge--${u.multiLine===!0?"multi":"single"}-line`+(u.outline===!0?" q-badge--outline":u.color!==void 0?` bg-${u.color}`:"")+(f!==void 0?` text-${f}`:"")+(u.floating===!0?" q-badge--floating":"")+(u.rounded===!0?" q-badge--rounded":"")+(u.transparent===!0?" q-badge--transparent":"")});return()=>g("div",{class:s.value,style:t.value,role:"status","aria-label":u.label},Ye(l.default,u.label!==void 0?[u.label]:[]))}});const ka=F({__name:"CurrentOrderDishesBadge",setup(u){const l=J(),t=c(()=>l.state.currentOrder.order),s=T("");return X(()=>K(t.value),()=>{const f=K(t.value);setTimeout(()=>{s.value=f||""},Ge)},{immediate:!0}),(f,S)=>t.value?(d(),h(De,{key:0,rounded:"",floating:"",color:"red",label:s.value},null,8,["label"])):I("",!0)}}),Yt={key:1},Gt={key:0},jt={class:"row justify-end q-gutter-sm"},Ht={class:"q-mt-xl"},Wt={key:0,class:"column justify-center items-center"},Xt={class:"text-h6"},Kt={class:"row no-wrap"},Ia=F({__name:"CurrentOrderView",setup(u){const l=J(),t=c(()=>l.state.currentOrder.order),s=Z(),f=T(!1),S=T(!1),x=T(!1),N=T(!1),q=c(()=>l.state.auth.user.userId),U=c(()=>q.value===ut.userId?[W.DINING_TABLES]:[W.DINING_TABLES,W.ADDRESSES_OF_CLIENT(q.value)]),p=c(()=>{var o;return(o=l.state.auth.user.permissions)==null?void 0:o.client}),C=c(()=>{var o,a;return((o=t.value)==null?void 0:o.address)&&!t.value.address.id?[...l.state.addresses.addresses,(a=t.value)==null?void 0:a.address]:l.state.addresses.addresses}),D=T(""),Re=c(()=>Se(C.value,["city","homeNumber","postalCode","street"])),Ve=c(()=>Re.value.search(D.value).map(o=>M(o))),ee=T(""),qe=c(()=>Se(l.state.diningTables.tables,["number"])),$e=c(()=>qe.value.search(ee.value).map(o=>o.number)),$=It(U,{store:l}),te=c(()=>l.state.diningTables.tables),ae=c(()=>l.state.currentOrder.previous),z=c(()=>{var o;return $.value?[]:(o=t.value)==null?void 0:o.dishes.map(a=>({dish:a,count:a.count,modifications:a.modifications,totalCost:_t({count:a.count,price:a.price,modifications:a.modifications.map(O=>({count:O.count,price:O.price}))})}))}),P=c(()=>{var o;return((o=z.value)==null?void 0:o.some(a=>!a.dish.isActive))||!1}),re=c(()=>{var o;return((o=z.value)==null?void 0:o.reduce((a,O)=>a+O.totalCost,0))||0}),Le=c(()=>{var o;return re.value+(((o=t.value)==null?void 0:o.type)===w.DELIVERY?Ce:0)}),R=T(!1),L=je(),V=c(()=>dt.map(o=>({label:s.value[`orderType_${o}`],value:o,icon:xt(o)}))),Y=T(L.query.table?V.value.find(o=>o.value===w.DINE_IN):V.value.find(o=>o.value===w.TAKEOUT)),Be=He(),Me=We(),oe=c(()=>{var o;return((o=t.value)==null?void 0:o.type)===w.DELIVERY&&!t.value.address}),Qe=X($,()=>{$.value||(L.query.table&&l.commit.crossTab(Ne({table:te.value.find(o=>{var a,O;return o.number===((O=(a=L.query.table)==null?void 0:a.toString())==null?void 0:O.trim())})||null})),Qe())},{immediate:!0});X(t,(o,a)=>{var O;o&&!a&&l.commit.crossTab(ct({order:void 0})),t.value&&C.value.length&&!((O=t.value)!=null&&O.address)&&l.commit.crossTab(G({address:C.value[0]}))},{immediate:!0});const Fe=(o,a)=>{a(()=>{ee.value=o})},Ue=(o,a)=>{a(()=>{D.value=o})};function ze(){l.commit.crossTab(mt()),f.value=!1}async function le(){var o,a;if(!Me.value){l.commit.crossTab(Ke({value:!0})),Be.push(`/login?text=${Ze}`);return}x.value=!0;try{if((o=t.value)!=null&&o.type||await l.commit.crossTab(he({type:Y.value.value})),((a=t.value)==null?void 0:a.type)===w.DINE_IN&&t.value.table&&!p.value&&!S.value){if(await l.commit.sync(Je({tableId:t.value.table.id})),l.state.orders.tableTakenByOrderNumber){N.value=!0;return}}else S.value&&(S.value=!1);await Rt(l,s)}finally{x.value=!1}}return(o,a)=>{const O=Xe("RouterLink");return d(),k(ge,null,[n(Nt,{onSubmit:le,onValidationError:e(kt)},{default:i(()=>{var b;return[n(Et,{"has-content":Boolean(t.value),"dish-count":e(K)(t.value),"total-cost":Le.value,"delivery-cost":e(Ce),"dish-cost":re.value,"order-type":(b=t.value)==null?void 0:b.type,"custom-empty":""},{content:i(()=>{var E,se,ne,ie,ue,de,ce,me,ve,pe,fe,be,ye;return[e($)?(d(),h(St,{key:0})):(d(),k("div",Yt,[v("div",null,[n(H,{"model-value":V.value.find(r=>{var y;return r.value===((y=t.value)==null?void 0:y.type)})||Y.value,"onUpdate:modelValue":a[0]||(a[0]=r=>e(l).commit.crossTab(e(he)({type:r.value}))),"stack-label":"",options:V.value,label:e(s).orderTypeLabel,class:"q-mb-md"},{before:i(()=>{var r;return[n(Oe,{name:(r=V.value.find(y=>{var _e;return y.value===(((_e=t.value)==null?void 0:_e.type)||Y.value.value)}))==null?void 0:r.icon},null,8,["name"])]}),option:i(r=>[n(j,et(tt(r.itemProps)),{default:i(()=>[n(B,{avatar:""},{default:i(()=>[n(Oe,{name:r.opt.icon},null,8,["name"])]),_:2},1024),n(B,null,{default:i(()=>[n(Ct,null,{default:i(()=>[_(m(r.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["model-value","options","label"]),((E=t.value)==null?void 0:E.type)===e(w).DELIVERY?(d(),k("div",Gt,[n(H,{"model-value":e(M)(t.value.address),"onUpdate:modelValue":a[2]||(a[2]=r=>e(l).commit.crossTab(e(G)({address:C.value.find(y=>e(M)(y)===r)}))),"use-input":"","fill-input":"","stack-label":"","hide-selected":"",clearable:"","input-debounce":"0",options:Ve.value,onFilter:Ue,label:`${e(s).deliveryAddress} *`,rules:[r=>!!r&&r.length>0||e(s).fieldRequired]},{after:i(()=>[n(A,{round:"",dense:"",icon:"add",color:"primary",onClick:a[1]||(a[1]=r=>R.value=!0),title:e(s).addNewDeliveryAddress},{default:i(()=>[n(Q,null,{default:i(()=>[_(m(e(s).addNewDeliveryAddress),1)]),_:1})]),_:1},8,["title"])]),"no-option":i(()=>[n(j,null,{default:i(()=>[n(B,null,{default:i(()=>[_(m(e(s).noResults),1)]),_:1})]),_:1})]),_:1},8,["model-value","options","label","rules"])])):I("",!0),!p.value&&((se=t.value)==null?void 0:se.type)===e(w).DELIVERY?(d(),h(Ie,{key:1,"model-value":(ie=(ne=t.value)==null?void 0:ne.client)==null?void 0:ie.firstName,"onUpdate:modelValue":a[3]||(a[3]=r=>e(l).commit.crossTab(e(at)({firstName:(r==null?void 0:r.toString())||""}))),"stack-label":"",label:`${e(s).clientFirstName} *`,"lazy-rules":"",type:"text",rules:[r=>!!r&&r.length>0||e(s).fieldRequired,r=>r.length<=e(Te)||e(s).maxLength({max:e(Te)})]},null,8,["model-value","label","rules"])):I("",!0),!p.value&&((ue=t.value)==null?void 0:ue.type)==="delivery"?(d(),h(Dt,{key:2,"model-value":((ce=(de=t.value)==null?void 0:de.client)==null?void 0:ce.phone)||"","onUpdate:modelValue":a[4]||(a[4]=r=>e(l).commit.crossTab(e(rt)({phone:r}))),shouldValidateFormat:""},null,8,["model-value"])):I("",!0),((me=t.value)==null?void 0:me.type)===e(w).DINE_IN?(d(),h(H,{key:3,"model-value":(pe=(ve=t.value)==null?void 0:ve.table)==null?void 0:pe.number,"onUpdate:modelValue":a[5]||(a[5]=r=>e(l).commit.crossTab(e(Ne)({table:te.value.find(y=>y.number===(r==null?void 0:r.trim()))||null}))),"use-input":"","fill-input":"","stack-label":"",clearable:"","hide-selected":"","input-debounce":"0",disable:!!e(L).query.table&&!!((be=(fe=t.value)==null?void 0:fe.table)!=null&&be.number),options:$e.value,onFilter:Fe,label:`${e(s).tableNumberLabel} *`,rules:[r=>!!r&&r.length>0||e(s).fieldRequired]},{"no-option":i(()=>[n(j,null,{default:i(()=>[n(B,null,{default:i(()=>[_(m(e(s).noResults),1)]),_:1})]),_:1})]),_:1},8,["model-value","disable","options","label","rules"])):I("",!0),n(Ie,{"model-value":(ye=t.value)==null?void 0:ye.comment,"onUpdate:modelValue":a[6]||(a[6]=r=>e(l).commit.crossTab(e(ot)({comment:(r==null?void 0:r.toString())||""}))),"stack-label":"",label:`${e(s).commentLabel}`,"lazy-rules":"",type:"textarea",rows:"1",autogrow:"",rules:[r=>!r||r.length<=e(ke)||e(s).maxLength({max:e(ke)})]},null,8,["model-value","label","rules"])]),v("div",null,[(d(!0),k(ge,null,lt(z.value,r=>(d(),k("div",{key:r.dish.dishIdInOrder},[n(wt,{dish:r.dish,count:r.count,"total-cost":r.totalCost,modifications:r.modifications.map(y=>({count:y.count,modification:y})),onDelete:y=>e(l).commit.crossTab(e(st)({dishIdInOrder:r.dish.dishIdInOrder})),onIncrement:y=>e(l).commit.crossTab(e(nt)({dish:r.dish})),onDecrement:y=>e(l).commit.crossTab(e(it)({dish:{id:r.dish.id,modifications:r.dish.modifications}}))},null,8,["dish","count","total-cost","modifications","onDelete","onIncrement","onDecrement"]),n(Ot)]))),128))])]))]}),options:i(()=>[v("div",jt,[n(A,{color:"negative",flat:"",onClick:a[7]||(a[7]=E=>f.value=!0),type:"button"},{default:i(()=>[_(m(e(s).clearOrder),1)]),_:1}),n(A,{color:"primary",type:"submit",loading:x.value,disable:P.value||oe.value},{default:i(()=>[_(m(e(s).createOrder)+" ",1),P.value||oe.value?(d(),h(Q,{key:0,class:"bg-negative text-white text-body1","max-width":"200px"},{default:i(()=>[_(m(P.value?e(s).cannotCreateOrderWithOutOfStock:e(s).specifyDeliveryAddress),1)]),_:1})):I("",!0)]),_:1},8,["loading","disable"])])]),empty:i(()=>[v("div",Ht,[ae.value?(d(),k("div",Wt,[n(Tt,{src:"/images/cart.svg",alt:"Cart",fit:"cover",class:"image-md"}),v("p",Xt,m(e(s).orderWasCreated)+"!",1),n(O,{class:"text-body1 q-mt-sm",to:`/orders/${ae.value.orderNumber}`},{default:i(()=>[_(m(e(s).viewOrder),1)]),_:1},8,["to"])])):(d(),h(Ee,{key:1,text:e(s).emptyOrder},null,8,["text"]))])]),_:1},8,["has-content","dish-count","total-cost","delivery-cost","dish-cost","order-type"])]}),_:1},8,["onValidationError"]),n(Ae,{modelValue:f.value,"onUpdate:modelValue":a[8]||(a[8]=b=>f.value=b)},{body:i(()=>[_(m(e(s).confirmCurrentOrderClear)+"? ",1)]),confirmButton:i(()=>[n(A,{flat:"",label:e(s).clearOrder,color:"negative",onClick:ze},null,8,["label"])]),_:1},8,["modelValue"]),R.value?(d(),h(At,{key:0,modelValue:R.value,"onUpdate:modelValue":a[9]||(a[9]=b=>R.value=b),onSubmit:a[10]||(a[10]=b=>(R.value=!1,e(l).commit.crossTab(e(G)({address:b}))))},null,8,["modelValue"])):I("",!0),n(Ae,{modelValue:N.value,"onUpdate:modelValue":a[12]||(a[12]=b=>N.value=b)},{body:i(()=>{var b,E;return[v("div",Kt,[v("div",null,m(e(s).confirmOrderWithTakenTableCreate1({tableNumber:((E=(b=t.value)==null?void 0:b.table)==null?void 0:E.number)||""})),1),_(" \xA0 "),n(xe,{orderNumber:e(l).state.orders.tableTakenByOrderNumber||"","is-link":""},null,8,["orderNumber"])]),v("div",null,m(e(s).confirmOrderWithTakenTableCreate2),1)]}),confirmButton:i(()=>[n(A,{flat:"",label:e(s).createOrder,color:"primary",onClick:a[11]||(a[11]=b=>(S.value=!0,N.value=!1,le()))},null,8,["label"])]),_:1},8,["modelValue"])],64)}}}),Zt=[g("g",{fill:"none","fill-rule":"evenodd",transform:"translate(1 1)","stroke-width":"2"},[g("circle",{cx:"22",cy:"22",r:"6"},[g("animate",{attributeName:"r",begin:"1.5s",dur:"3s",values:"6;22",calcMode:"linear",repeatCount:"indefinite"}),g("animate",{attributeName:"stroke-opacity",begin:"1.5s",dur:"3s",values:"1;0",calcMode:"linear",repeatCount:"indefinite"}),g("animate",{attributeName:"stroke-width",begin:"1.5s",dur:"3s",values:"2;0",calcMode:"linear",repeatCount:"indefinite"})]),g("circle",{cx:"22",cy:"22",r:"6"},[g("animate",{attributeName:"r",begin:"3s",dur:"3s",values:"6;22",calcMode:"linear",repeatCount:"indefinite"}),g("animate",{attributeName:"stroke-opacity",begin:"3s",dur:"3s",values:"1;0",calcMode:"linear",repeatCount:"indefinite"}),g("animate",{attributeName:"stroke-width",begin:"3s",dur:"3s",values:"2;0",calcMode:"linear",repeatCount:"indefinite"})]),g("circle",{cx:"22",cy:"22",r:"8"},[g("animate",{attributeName:"r",begin:"0s",dur:"1.5s",values:"6;1;2;3;4;5;6",calcMode:"linear",repeatCount:"indefinite"})])])];var Jt=we({name:"QSpinnerRings",props:vt,setup(u){const{cSize:l,classes:t}=pt(u);return()=>g("svg",{class:t.value,stroke:"currentColor",width:l.value,height:l.value,viewBox:"0 0 45 45",xmlns:"http://www.w3.org/2000/svg"},Zt)}});const ea={class:"q-px-xs",style:{"min-width":"300px"}},ta={key:0},Sa=F({__name:"NotificationsBell",props:{isLoading:{type:Boolean},notificationCount:{}},setup(u){const l=Z();return(t,s)=>(d(),h(A,{class:"q-mr-xs",flat:"",round:"",icon:"o_notifications",title:e(l).showNotifications},{default:i(()=>[n(Q,null,{default:i(()=>[_(m(e(l).showNotifications),1)]),_:1}),t.isLoading?(d(),h(Jt,{key:0,color:"primary",size:"40px",class:"absolute-top-right-offset"})):I("",!0),t.notificationCount?(d(),h(De,{key:1,rounded:"",floating:"",color:"red",label:t.notificationCount||""},null,8,["label"])):I("",!0),n(Vt,{fit:"",class:"notification-bell-menu",role:""},{default:i(()=>[v("div",ea,[n(ft,{tag:"div",name:"fade",style:{"min-width":"300px"}},{default:i(()=>[t.notificationCount?bt(t.$slots,"notification-list",{key:1}):(d(),k("p",ta,[(d(),h(Ee,{key:"empty",text:e(l).noNotifications,class:"q-py-lg"},null,8,["text"]))]))]),_:3})])]),_:3})]),_:3},8,["title"]))}});export{Na as _,Sa as a,ka as b,Ia as c};
