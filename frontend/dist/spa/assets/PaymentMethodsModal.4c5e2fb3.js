import{Q as I}from"./QSpace.9655fa2d.js";import{d as P,h as x,a as T,u as N,r as C,H as R,e as y,w as l,o as m,k as e,a5 as k,n as h,g as t,j as v,t as p,ah as V,aX as A,A as z,aY as F,aZ as W,aD as Y,a_ as j,i as $,aj as L,f as q,a$ as H,b0 as G,aB as K,aC as X,b1 as Z,b2 as J,az as B}from"./index.a23228fb.js";import{Q as f}from"./QCardSection.444a02ed.js";import{Q as M}from"./QCard.ad74cc7a.js";import{Q}from"./QDialog.7ec1d928.js";import{C as w}from"./ClosePopup.365cb15f.js";import{_ as E}from"./ClickableCardItem.20c1b4ac.js";import{B as O}from"./BigSpinner.2648fee4.js";import{b as ee}from"./browser.1a1bd576.js";import{Q as te}from"./QInput.8468814f.js";import{Q as ae,o as le}from"./on-form-validation-error.b0ec5e9c.js";import{f as U,w as D}from"./currency.2af12bed.js";const oe={class:"text-center"},se={class:"text-h5 q-mb-sm"},re={class:"text-body1 text-dark-gray q-mb-md"},ne=P({__name:"ClientDineInCashPaymentModal",props:{orderId:{},modelValue:{type:Boolean}},emits:["close","update:modelValue"],setup(_,{emit:c}){const r=_,u=x(()=>r.modelValue),s=c,d=T(),i=N(),o=C(!1),a=C(!1);return R(u,()=>{!u.value||(o.value=!0,d.commit.sync(A({orderId:r.orderId})).then(()=>{a.value=!0}).catch(()=>{a.value=!1}).finally(()=>{o.value=!1}))},{immediate:!0}),(n,b)=>(m(),y(Q,{"model-value":u.value,"onUpdate:modelValue":b[0]||(b[0]=g=>s("update:modelValue",g))},{default:l(()=>[e(M,{class:"dialog-sm q-pb-md q-px-md"},{default:l(()=>[e(f,{class:"row items-center q-pb-none"},{default:l(()=>[e(I),k(e(h,{icon:"close",flat:"",round:"",dense:"",title:t(i).close},null,8,["title"]),[[w]])]),_:1}),o.value?(m(),y(O,{key:0})):a.value?(m(),y(f,{key:1},{default:l(()=>[v("div",oe,[v("p",se,p(t(i).waiterWasCalled),1),v("p",re,p(t(i).waiterWillAcceptPayment),1),k(e(h,{label:t(i).ok,color:"primary",class:"q-mx-auto d-block"},null,8,["label"]),[[w]])])]),_:1})):V("",!0)]),_:1})]),_:1},8,["model-value"]))}}),ue={class:"text-center"},de={class:"text-h5 q-mb-lg"},ie=P({__name:"ClientTakeoutDeliveryCashPaymentModal",props:{modelValue:{type:Boolean}},emits:["close","update:modelValue"],setup(_,{emit:c}){const r=_,u=x(()=>r.modelValue),s=c,d=N();return(i,o)=>(m(),y(Q,{"model-value":u.value,"onUpdate:modelValue":o[0]||(o[0]=a=>s("update:modelValue",a))},{default:l(()=>[e(M,{class:"dialog-sm q-pb-md q-px-md"},{default:l(()=>[e(f,{class:"row items-center q-pb-none"},{default:l(()=>[e(I),k(e(h,{icon:"close",flat:"",round:"",dense:"",title:t(d).close},null,8,["title"]),[[w]])]),_:1}),e(f,null,{default:l(()=>[v("div",ue,[v("p",de,p(t(d).payInCashUponReceipt),1),k(e(h,{label:t(d).ok,color:"primary",class:"q-mx-auto d-block"},null,8,["label"]),[[w]])])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),me={key:0,class:"text-h4 text-center q-mb-md"},ce={key:1},pe=P({__name:"PaymentCard",props:{orderNumber:{},method:{}},setup(_){const c=_,r=N(),u=C(!1),s=T(),d=x(()=>s.state.orders.paymentLink),i=C(),o=x(()=>{var n;return(n=s.state.auth.user.permissions)==null?void 0:n.client});z(async()=>{var n,b;(n=i.value)==null||n.replaceChildren(),u.value=!0;try{if(await a(),F("paymentLink:",d.value),W(d.value,"payment link was not received"),o.value)window.open(d.value,"_self");else try{const g=await ee.toCanvas(d.value,{errorCorrectionLevel:"M",version:14,width:280});(b=i.value)==null||b.appendChild(g)}catch(g){Y("QR code generation error:",g)}}finally{u.value=!1}});async function a(){return await s.commit.sync(j({orderNumber:c.orderNumber,method:c.method}))}return(n,b)=>(m(),$(L,null,[e(f,null,{default:l(()=>[u.value?V("",!0):(m(),$("p",me,p(o.value?t(r).clickToPay:t(r).scanQrCode),1))]),_:1}),e(f,null,{default:l(()=>[u.value?(m(),y(O,{key:0})):V("",!0),v("div",{ref_key:"qrCodeContainer",ref:i,class:"w-fit q-mx-auto"},null,512),!u.value&&o.value?(m(),$("div",ce,[e(h,{color:"primary",class:"q-mx-auto d-block w-fit",href:d.value},{default:l(()=>[q(p(t(r).pay),1)]),_:1},8,["href"])])):V("",!0)]),_:1})],64))}}),fe=P({__name:"CreditCardOrBlikPaymentModal",props:{orderNumber:{},modelValue:{type:Boolean},method:{}},emits:["update:modelValue"],setup(_,{emit:c}){const r=_,u=c,s=N(),d=x(()=>r.modelValue);return(i,o)=>(m(),y(Q,{maximized:"","model-value":d.value,"onUpdate:modelValue":o[0]||(o[0]=a=>u("update:modelValue",a))},{default:l(()=>[e(M,{class:"q-pb-sm"},{default:l(()=>[e(f,{class:"row items-center q-pb-none"},{default:l(()=>[e(I),k(e(h,{icon:"close",flat:"",round:"",dense:"",size:"lg",title:t(s).close},null,8,["title"]),[[w]])]),_:1}),d.value?(m(),y(pe,{key:0,"order-number":i.orderNumber,method:i.method},null,8,["order-number","method"])):V("",!0)]),_:1})]),_:1},8,["model-value"]))}}),ve={class:"text-h5 text-center"},ye={class:"text-h5"},_e={class:"text-primary"},be={class:"text-h5"},Ce={key:0,class:"text-primary"},he={key:1},ge=P({__name:"WaiterCashPaymentModal",props:{totalCost:{},orderNumber:{}},emits:["close","paid"],setup(_,{emit:c}){const r=_,u=c,s=N(),d=C(""),i=x(()=>Math.max(D(+d.value)-r.totalCost,0)),o=C(!1),a=T();async function n(){o.value=!0,a.commit.sync(G({orderNumber:r.orderNumber})).then(()=>{K.create({type:"positive",position:"top",timeout:X,message:s.value.paymentSuccess,multiLine:!0,group:!1}),u("close"),u("paid")}).finally(()=>{o.value=!1})}return(b,g)=>(m(),y(Q,null,{default:l(()=>[e(M,{class:"dialog-sm q-pb-md q-px-md"},{default:l(()=>[e(f,{class:"row items-center q-pb-none"},{default:l(()=>[e(I),k(e(h,{icon:"close",flat:"",round:"",dense:"",title:t(s).close},null,8,["title"]),[[w]])]),_:1}),e(f,null,{default:l(()=>[v("p",ve,p(t(s).payWithCash),1)]),_:1}),e(f,null,{default:l(()=>[v("p",ye,[q(p(t(s).totalToPay)+": ",1),v("span",_e,p(t(U)(b.totalCost)),1)])]),_:1}),e(ae,{onSubmit:n,onValidationError:t(le)},{default:l(()=>[e(f,null,{default:l(()=>[e(te,{modelValue:d.value,"onUpdate:modelValue":g[0]||(g[0]=S=>d.value=S),modelModifiers:{number:!0},"stack-label":"",label:`${t(s).amount} *`,hint:t(s).amountHint,"lazy-rules":"",type:"number",step:"0.01",rules:[S=>S!==""||t(s).fieldRequired,S=>t(D)(S)>=b.totalCost||t(s).minValue({min:t(U)(b.totalCost)})]},null,8,["modelValue","label","hint","rules"])]),_:1}),e(f,null,{default:l(()=>[v("p",be,[q(p(t(s).change)+": ",1),i.value>0?(m(),$("span",Ce,p(t(U)(i.value)),1)):(m(),$("span",he,"-"))]),k(v("p",{class:"text-caption text-negative q-mt-xs"},p(t(s).makeSureChangeGiven),513),[[H,i.value>0]])]),_:1}),e(f,{align:"center"},{default:l(()=>[e(h,{color:"primary",type:"submit",class:"q-px-lg",loading:o.value},{default:l(()=>[q(p(t(s).pay),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["onValidationError"])]),_:1})]),_:1}))}}),Ve={class:"text-h5 text-center"},Be=P({__name:"PaymentMethodsModal",props:{totalCost:{},orderNumber:{},orderId:{},orderType:{}},setup(_){const c=N(),r=C(!1),u=C(!1),s=C("card"),d=T(),i=x(()=>{var o;return(o=d.state.auth.user.permissions)==null?void 0:o.client});return(o,a)=>(m(),$(L,null,[e(Q,Z(J(o.$attrs)),{default:l(()=>[e(M,{class:"dialog-sm q-pb-md q-px-md"},{default:l(()=>[e(f,{class:"row items-center q-pb-none"},{default:l(()=>[e(I),k(e(h,{icon:"close",flat:"",round:"",dense:"",title:t(c).close},null,8,["title"]),[[w]])]),_:1}),e(f,null,{default:l(()=>[v("p",Ve,p(t(c).selectPaymentMethod),1)]),_:1}),e(f,null,{default:l(()=>[e(E,{"image-src":"/images/cash.svg",onClick:a[0]||(a[0]=n=>r.value=!0)},{text:l(()=>[q(p(t(c).cash),1)]),_:1}),e(E,{class:"q-mt-lg","image-src":"/images/credit-card.svg",onClick:a[1]||(a[1]=n=>{s.value="card",u.value=!0})},{text:l(()=>[q(p(t(c).creditCard),1)]),_:1}),e(E,{class:"q-mt-lg","image-src":"/images/blik.png",onClick:a[2]||(a[2]=n=>{s.value="blik",u.value=!0})},{text:l(()=>[q(p(t(c).blik),1)]),_:1})]),_:1})]),_:1})]),_:1},16),i.value?V("",!0):(m(),y(ge,{key:0,modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=n=>r.value=n),onClose:a[4]||(a[4]=n=>r.value=!1),"total-cost":o.totalCost,"order-number":o.orderNumber},null,8,["modelValue","total-cost","order-number"])),i.value&&o.orderType===t(B).DINE_IN?(m(),y(ne,{key:1,modelValue:r.value,"onUpdate:modelValue":a[5]||(a[5]=n=>r.value=n),onClose:a[6]||(a[6]=n=>r.value=!1),"order-id":o.orderId},null,8,["modelValue","order-id"])):V("",!0),i.value&&(o.orderType===t(B).TAKEOUT||o.orderType===t(B).DELIVERY)?(m(),y(ie,{key:2,modelValue:r.value,"onUpdate:modelValue":a[7]||(a[7]=n=>r.value=n),onClose:a[8]||(a[8]=n=>r.value=!1)},null,8,["modelValue"])):V("",!0),e(fe,{modelValue:u.value,"onUpdate:modelValue":a[9]||(a[9]=n=>u.value=n),"order-number":o.orderNumber,method:s.value},null,8,["modelValue","order-number","method"])],64))}});export{Be as _,ge as a};
