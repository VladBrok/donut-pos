import{Q as H}from"./QImg.bc00f4b6.js";import{Q as Z}from"./QTooltip.64d8fdeb.js";import{v as G,r as L,h as d,U as J,C as X,S as ee,q as C,p as te,K as le,N as ne,d as ae,u as ie,a9 as ue,o as re,i as se,j as oe,k as N,g as y,w as B,n as ce,bi as de,a_ as fe,bj as Q,bk as M,bl as me,f as ve,t as pe}from"./index.3f3b8c57.js";import{Q as ge,h as be}from"./QChip.e4eb7192.js";import{u as Fe,d as he,a as Se,c as ye,e as _e,j as xe,b as Ce,f as W}from"./QInput.af205288.js";function k(e,s,b,c){const n=[];return e.forEach(r=>{c(r)===!0?n.push(r):s.push({failedPropValidation:b,file:r})}),n}function O(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),X(e)}const Ie={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},je=["rejected"];function ke({editable:e,dnd:s,getFileInput:b,addFilesToQueue:c}){const{props:n,emit:r,proxy:p}=G(),F=L(null),I=d(()=>n.accept!==void 0?n.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),j=d(()=>parseInt(n.maxFiles,10)),S=d(()=>parseInt(n.maxTotalSize,10));function x(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target!==null&&t.target.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&J(t);else{const g=b();g&&g!==t.target&&g.click(t)}}function m(t){e.value&&t&&c(null,t)}function P(t,g,z,A){let a=Array.from(g||t.target.files);const v=[],_=()=>{v.length!==0&&r("rejected",v)};if(n.accept!==void 0&&I.value.indexOf("*/")===-1&&(a=k(a,v,"accept",i=>I.value.some(o=>i.type.toUpperCase().startsWith(o)||i.name.toUpperCase().endsWith(o))),a.length===0))return _();if(n.maxFileSize!==void 0){const i=parseInt(n.maxFileSize,10);if(a=k(a,v,"max-file-size",o=>o.size<=i),a.length===0)return _()}if(n.multiple!==!0&&a.length!==0&&(a=[a[0]]),a.forEach(i=>{i.__key=i.webkitRelativePath+i.lastModified+i.name+i.size}),A===!0){const i=z.map(o=>o.__key);a=k(a,v,"duplicate",o=>i.includes(o.__key)===!1)}if(a.length===0)return _();if(n.maxTotalSize!==void 0){let i=A===!0?z.reduce((o,T)=>o+T.size,0):0;if(a=k(a,v,"max-total-size",o=>(i+=o.size,i<=S.value)),a.length===0)return _()}if(typeof n.filter=="function"){const i=n.filter(a);a=k(a,v,"filter",o=>i.includes(o))}if(n.maxFiles!==void 0){let i=A===!0?z.length:0;if(a=k(a,v,"max-files",()=>(i++,i<=j.value)),a.length===0)return _()}if(_(),a.length!==0)return a}function D(t){O(t),s.value!==!0&&(s.value=!0)}function u(t){X(t),(t.relatedTarget!==null||ee.is.safari!==!0?t.relatedTarget!==F.value:document.elementsFromPoint(t.clientX,t.clientY).includes(F.value)===!1)===!0&&(s.value=!1)}function E(t){O(t);const g=t.dataTransfer.files;g.length!==0&&c(null,g),s.value=!1}function R(t){if(s.value===!0)return C("div",{ref:F,class:`q-${t}__dnd absolute-full`,onDragenter:O,onDragover:O,onDragleave:u,onDrop:E})}return Object.assign(p,{pickFiles:x,addFiles:m}),{pickFiles:x,addFiles:m,onDragover:D,onDragleave:u,processFiles:P,getDndNode:R,maxFilesNumber:j,maxTotalSizeNumber:S}}var ze=te({name:"QFile",inheritAttrs:!1,props:{...Fe,...he,...Ie,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...Se,...je],setup(e,{slots:s,emit:b,attrs:c}){const{proxy:n}=G(),r=ye(),p=L(null),F=L(!1),I=_e(e),{pickFiles:j,onDragover:S,onDragleave:x,processFiles:m,getDndNode:P}=ke({editable:r.editable,dnd:F,getFileInput:w,addFilesToQueue:q}),D=xe(e),u=d(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),E=d(()=>W(u.value)),R=d(()=>u.value.map(l=>l.name).join(", ")),t=d(()=>be(u.value.reduce((l,f)=>l+f.size,0))),g=d(()=>({totalSize:t.value,filesNumber:u.value.length,maxFiles:e.maxFiles})),z=d(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:I.value,...c,id:r.targetUid.value,disabled:r.editable.value!==!0})),A=d(()=>"q-file q-field--auto-height"+(F.value===!0?" q-file--dnd":"")),a=d(()=>e.multiple===!0&&e.append===!0);function v(l){const f=u.value.slice();f.splice(l,1),i(f)}function _(l){const f=u.value.indexOf(l);f>-1&&v(f)}function i(l){b("update:modelValue",e.multiple===!0?l:l[0])}function o(l){l.keyCode===13&&ne(l)}function T(l){(l.keyCode===13||l.keyCode===32)&&j(l)}function w(){return p.value}function q(l,f){const h=m(l,f,u.value,a.value),U=w();U!=null&&(U.value=""),h!==void 0&&((e.multiple===!0?e.modelValue&&h.every(K=>u.value.includes(K)):e.modelValue===h[0])||i(a.value===!0?u.value.concat(h):h))}function V(){return[C("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function Y(){if(s.file!==void 0)return u.value.length===0?V():u.value.map((f,h)=>s.file({index:h,file:f,ref:this}));if(s.selected!==void 0)return u.value.length===0?V():s.selected({files:u.value,ref:this});if(e.useChips===!0)return u.value.length===0?V():u.value.map((f,h)=>C(ge,{key:"file-"+h,removable:r.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{v(h)}},()=>C("span",{class:"ellipsis",textContent:f.name})));const l=e.displayValue!==void 0?e.displayValue:R.value;return l.length!==0?[C("div",{class:e.inputClass,style:e.inputStyle,textContent:l})]:V()}function $(){const l={ref:p,...z.value,...D.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:q};return e.multiple===!0&&(l.multiple=!0),C("input",l)}return Object.assign(r,{fieldClass:A,emitValue:i,hasValue:E,inputRef:p,innerValue:u,floatingLabel:d(()=>E.value===!0||W(e.displayValue)),computedCounter:d(()=>{if(e.counterLabel!==void 0)return e.counterLabel(g.value);const l=e.maxFiles;return`${u.value.length}${l!==void 0?" / "+l:""} (${t.value})`}),getControlChild:()=>P("file"),getControl:()=>{const l={ref:r.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return r.editable.value===!0&&Object.assign(l,{onDragover:S,onDragleave:x,onKeydown:o,onKeyup:T}),C("div",l,[$()].concat(Y()))}}),Object.assign(n,{removeAtIndex:v,removeFile:_,getNativeElement:()=>p.value}),le(n,"nativeEl",()=>p.value),Ce(r)}});const Ae={class:"row justify-center q-mb-lg"},Ee={class:"image-md relative-position"},De=ae({__name:"PhotoUpload",props:{url:{},file:{}},emits:["update:url","update:file"],setup(e,{emit:s}){const b=e,c=s,n=d(()=>b.url||de),r=d(()=>b.file),p=ie(),F=L();ue(()=>{r.value&&(URL.revokeObjectURL(n.value),c("update:file",void 0))});const I=()=>{fe(F.value,"file input component is missing"),F.value.pickFiles()},j=S=>{c("update:file",S),S&&(URL.revokeObjectURL(n.value),c("update:url",URL.createObjectURL(S)))};return(S,x)=>(re(),se("div",Ae,[oe("div",Ee,[N(H,{src:n.value,fit:"cover",class:"image-md rounded-borders"},null,8,["src"]),N(y(ze),{ref_key:"fileInputRef",ref:F,class:"show-validation-errors-only q-mr-sm",accept:y(Q).join(", "),"model-value":r.value,"onUpdate:modelValue":x[0]||(x[0]=m=>j(m)),rules:[m=>!m||m.size<=y(M)||y(p).maxFileSize({max:(y(M)/1e6).toFixed(2)}),m=>!m||y(Q).includes(m.type)||y(p).allowedFilesAre({allowed:y(me).join(", ")})]},null,8,["accept","model-value","rules"]),N(ce,{class:"absolute-bottom-right-offset",icon:"upload",round:"",color:"primary",onClick:I},{default:B(()=>[N(Z,null,{default:B(()=>[ve(pe(y(p).uploadImage),1)]),_:1})]),_:1})])]))}});function Re(e){return new Promise((s,b)=>{const c=new FileReader;c.onloadend=()=>{let n=c.result;const r=n.indexOf("base64,");n=n.slice(r+7),s(n)},c.onerror=()=>{b("Failed to convert blob to base64.")},c.readAsDataURL(e)})}export{De as _,Re as b};
