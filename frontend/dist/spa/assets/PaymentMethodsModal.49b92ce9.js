import{Q as I}from"./QSpace.b6962a17.js";import{d as Q,h as $,a as T,u as P,r as C,H as O,o as i,e as y,w as t,aY as z,k as e,a5 as g,n as h,j as v,t as p,g as l,ag as V,A as F,aZ as W,a_ as Y,aC as H,a$ as j,i as x,ai as A,f as w,m as G,am as K,b0 as Z,b1 as J,aA as X,aB as ee,b2 as te,b3 as ae,ay as B}from"./index.3f3b8c57.js";import{Q as f}from"./QCardSection.1779170a.js";import{Q as N}from"./QCard.bbe847d6.js";import{Q as M}from"./QDialog.8f914458.js";import{C as q}from"./ClosePopup.880cf5c6.js";import{B as D}from"./BigSpinner.f02a38f1.js";import{b as le}from"./browser.1a1bd576.js";import{Q as oe}from"./QImg.bc00f4b6.js";import{Q as L,b as se,a as re}from"./QItemLabel.b85da9a3.js";import{Q as ne}from"./QList.cda24842.js";import{Q as ue}from"./QInput.af205288.js";import{Q as de,o as me}from"./on-form-validation-error.a634981b.js";import{w as R,f as E}from"./currency.2af12bed.js";const ie={class:"text-center"},ce={class:"text-h5 q-mb-sm"},pe={class:"text-body1 text-dark-gray q-mb-md"},fe=Q({__name:"ClientDineInCashPaymentModal",props:{orderId:{},modelValue:{type:Boolean}},emits:["close","update:modelValue"],setup(_,{emit:c}){const r=_,n=$(()=>r.modelValue),o=c,d=T(),m=P(),s=C(!1),a=C(!1);return O(n,()=>{!n.value||(s.value=!0,d.commit.sync(z({orderId:r.orderId})).then(()=>{a.value=!0}).catch(()=>{a.value=!1}).finally(()=>{s.value=!1}))},{immediate:!0}),(u,b)=>(i(),y(M,{"model-value":n.value,"onUpdate:modelValue":b[0]||(b[0]=k=>o("update:modelValue",k))},{default:t(()=>[e(N,{class:"dialog-sm q-pb-md q-px-md"},{default:t(()=>[e(f,{class:"row items-center q-pb-none"},{default:t(()=>[e(I),g(e(h,{icon:"close",flat:"",round:"",dense:""},null,512),[[q]])]),_:1}),s.value?(i(),y(D,{key:0})):a.value?(i(),y(f,{key:1},{default:t(()=>[v("div",ie,[v("p",ce,p(l(m).waiterWasCalled),1),v("p",pe,p(l(m).waiterWillAcceptPayment),1),g(e(h,{label:l(m).ok,color:"primary",class:"q-mx-auto d-block"},null,8,["label"]),[[q]])])]),_:1})):V("",!0)]),_:1})]),_:1},8,["model-value"]))}}),ve={class:"text-center"},ye={class:"text-h5 q-mb-lg"},_e=Q({__name:"ClientTakeoutDeliveryCashPaymentModal",props:{modelValue:{type:Boolean}},emits:["close","update:modelValue"],setup(_,{emit:c}){const r=_,n=$(()=>r.modelValue),o=c,d=P();return(m,s)=>(i(),y(M,{"model-value":n.value,"onUpdate:modelValue":s[0]||(s[0]=a=>o("update:modelValue",a))},{default:t(()=>[e(N,{class:"dialog-sm q-pb-md q-px-md"},{default:t(()=>[e(f,{class:"row items-center q-pb-none"},{default:t(()=>[e(I),g(e(h,{icon:"close",flat:"",round:"",dense:""},null,512),[[q]])]),_:1}),e(f,null,{default:t(()=>[v("div",ve,[v("p",ye,p(l(d).payInCashUponReceipt),1),g(e(h,{label:l(d).ok,color:"primary",class:"q-mx-auto d-block"},null,8,["label"]),[[q]])])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),be={key:0,class:"text-h4 text-center q-mb-md"},Ce={key:1},ge=Q({__name:"PaymentCard",props:{orderNumber:{},method:{}},setup(_){const c=_,r=P(),n=C(!1),o=T(),d=$(()=>o.state.orders.paymentLink),m=C(),s=$(()=>{var u;return(u=o.state.auth.user.permissions)==null?void 0:u.client});F(async()=>{var u,b;(u=m.value)==null||u.replaceChildren(),n.value=!0;try{if(await a(),W("paymentLink:",d.value),Y(d.value,"payment link was not received"),s.value)window.open(d.value,"_self");else try{const k=await le.toCanvas(d.value,{errorCorrectionLevel:"M",version:14,width:280});(b=m.value)==null||b.appendChild(k)}catch(k){H("QR code generation error:",k)}}finally{n.value=!1}});async function a(){return await o.commit.sync(j({orderNumber:c.orderNumber,method:c.method}))}return(u,b)=>(i(),x(A,null,[e(f,null,{default:t(()=>[n.value?V("",!0):(i(),x("p",be,p(s.value?l(r).clickToPay:l(r).scanQrCode),1))]),_:1}),e(f,null,{default:t(()=>[n.value?(i(),y(D,{key:0})):V("",!0),v("div",{ref_key:"qrCodeContainer",ref:m,class:"w-fit q-mx-auto"},null,512),!n.value&&s.value?(i(),x("div",Ce,[e(h,{color:"primary",class:"q-mx-auto d-block w-fit",href:d.value},{default:t(()=>[w(p(l(r).pay),1)]),_:1},8,["href"])])):V("",!0)]),_:1})],64))}}),he=Q({__name:"CreditCardOrBlikPaymentModal",props:{orderNumber:{},modelValue:{type:Boolean},method:{}},emits:["update:modelValue"],setup(_,{emit:c}){const r=_,n=c,o=$(()=>r.modelValue);return(d,m)=>(i(),y(M,{maximized:"","model-value":o.value,"onUpdate:modelValue":m[0]||(m[0]=s=>n("update:modelValue",s))},{default:t(()=>[e(N,{class:"q-pb-sm"},{default:t(()=>[e(f,{class:"row items-center q-pb-none"},{default:t(()=>[e(I),g(e(h,{icon:"close",flat:"",round:"",dense:"",size:"lg"},null,512),[[q]])]),_:1}),o.value?(i(),y(ge,{key:0,"order-number":d.orderNumber,method:d.method},null,8,["order-number","method"])):V("",!0)]),_:1})]),_:1},8,["model-value"]))}}),U=Q({__name:"PaymentMethodCard",props:{imageSrc:{}},emits:["click"],setup(_,{emit:c}){const r=c;return P(),(n,o)=>(i(),x("div",null,[e(ne,{bordered:"",separator:"",class:"rounded-borders"},{default:t(()=>[g((i(),y(re,{clickable:"",class:"q-px-md q-py-sm",onClick:o[0]||(o[0]=d=>r("click"))},{default:t(()=>[e(L,{avatar:"",class:"q-mr-xs"},{default:t(()=>[e(oe,{src:n.imageSrc,alt:"",fit:"contain",class:"image-xs-sm"},null,8,["src"])]),_:1}),e(L,null,{default:t(()=>[e(se,{class:"text-weight-bold text-h6"},{default:t(()=>[G(n.$slots,"text")]),_:3})]),_:3})]),_:3})),[[K],[q]])]),_:3})]))}}),ke={class:"text-h5 text-center"},Ve={class:"text-h5"},qe={class:"text-primary"},xe={class:"text-h5"},we={key:0,class:"text-primary"},$e={key:1},Qe=Q({__name:"WaiterCashPaymentModal",props:{totalCost:{},orderNumber:{}},emits:["close","paid"],setup(_,{emit:c}){const r=_,n=c,o=P(),d=C(""),m=$(()=>Math.max(R(+d.value)-r.totalCost,0)),s=C(!1),a=T();async function u(){s.value=!0,a.commit.sync(J({orderNumber:r.orderNumber})).then(()=>{X.create({type:"positive",position:"top",timeout:ee,message:o.value.paymentSuccess,multiLine:!0,group:!1}),n("close"),n("paid")}).finally(()=>{s.value=!1})}return(b,k)=>(i(),y(M,null,{default:t(()=>[e(N,{class:"dialog-sm q-pb-md q-px-md"},{default:t(()=>[e(f,{class:"row items-center q-pb-none"},{default:t(()=>[e(I),g(e(h,{icon:"close",flat:"",round:"",dense:""},null,512),[[q]])]),_:1}),e(f,null,{default:t(()=>[v("p",ke,p(l(o).payWithCash),1)]),_:1}),e(f,null,{default:t(()=>[v("p",Ve,[w(p(l(o).totalToPay)+": ",1),v("span",qe,p(l(E)(b.totalCost)),1)])]),_:1}),e(de,{onSubmit:u,onValidationError:l(me)},{default:t(()=>[e(f,null,{default:t(()=>[e(ue,{modelValue:d.value,"onUpdate:modelValue":k[0]||(k[0]=S=>d.value=S),modelModifiers:{number:!0},"stack-label":"",label:`${l(o).amount} *`,hint:l(o).amountHint,"lazy-rules":"",type:"number",step:"0.01",rules:[S=>S!==""||l(o).fieldRequired,S=>l(R)(S)>=b.totalCost||l(o).minValue({min:l(E)(b.totalCost)})]},null,8,["modelValue","label","hint","rules"])]),_:1}),e(f,null,{default:t(()=>[v("p",xe,[w(p(l(o).change)+": ",1),m.value>0?(i(),x("span",we,p(l(E)(m.value)),1)):(i(),x("span",$e,"-"))]),g(v("p",{class:"text-caption text-negative q-mt-xs"},p(l(o).makeSureChangeGiven),513),[[Z,m.value>0]])]),_:1}),e(f,{align:"center"},{default:t(()=>[e(h,{color:"primary",type:"submit",class:"q-px-lg",loading:s.value},{default:t(()=>[w(p(l(o).pay),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["onValidationError"])]),_:1})]),_:1}))}}),Pe={class:"text-h5 text-center"},Fe=Q({__name:"PaymentMethodsModal",props:{totalCost:{},orderNumber:{},orderId:{},orderType:{}},setup(_){const c=P(),r=C(!1),n=C(!1),o=C("card"),d=T(),m=$(()=>{var s;return(s=d.state.auth.user.permissions)==null?void 0:s.client});return(s,a)=>(i(),x(A,null,[e(M,te(ae(s.$attrs)),{default:t(()=>[e(N,{class:"dialog-sm q-pb-md q-px-md"},{default:t(()=>[e(f,{class:"row items-center q-pb-none"},{default:t(()=>[e(I),g(e(h,{icon:"close",flat:"",round:"",dense:""},null,512),[[q]])]),_:1}),e(f,null,{default:t(()=>[v("p",Pe,p(l(c).selectPaymentMethod),1)]),_:1}),e(f,null,{default:t(()=>[e(U,{"image-src":"/images/cash.svg",onClick:a[0]||(a[0]=u=>r.value=!0)},{text:t(()=>[w(p(l(c).cash),1)]),_:1}),e(U,{class:"q-mt-lg","image-src":"/images/credit-card.svg",onClick:a[1]||(a[1]=u=>{o.value="card",n.value=!0})},{text:t(()=>[w(p(l(c).creditCard),1)]),_:1}),e(U,{class:"q-mt-lg","image-src":"/images/blik.png",onClick:a[2]||(a[2]=u=>{o.value="blik",n.value=!0})},{text:t(()=>[w(p(l(c).blik),1)]),_:1})]),_:1})]),_:1})]),_:1},16),m.value?V("",!0):(i(),y(Qe,{key:0,modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=u=>r.value=u),onClose:a[4]||(a[4]=u=>r.value=!1),"total-cost":s.totalCost,"order-number":s.orderNumber},null,8,["modelValue","total-cost","order-number"])),m.value&&s.orderType===l(B).DINE_IN?(i(),y(fe,{key:1,modelValue:r.value,"onUpdate:modelValue":a[5]||(a[5]=u=>r.value=u),onClose:a[6]||(a[6]=u=>r.value=!1),"order-id":s.orderId},null,8,["modelValue","order-id"])):V("",!0),m.value&&(s.orderType===l(B).TAKEOUT||s.orderType===l(B).DELIVERY)?(i(),y(_e,{key:2,modelValue:r.value,"onUpdate:modelValue":a[7]||(a[7]=u=>r.value=u),onClose:a[8]||(a[8]=u=>r.value=!1)},null,8,["modelValue"])):V("",!0),e(he,{modelValue:n.value,"onUpdate:modelValue":a[9]||(a[9]=u=>n.value=u),"order-number":s.orderNumber,method:o.value},null,8,["modelValue","order-number","method"])],64))}});export{Fe as _,Qe as a};
