import{Q as H}from"./QImg.ec5547d3.js";import{Q as Z}from"./QTooltip.2af661a3.js";import{v as G,r as L,h as d,U as J,C as X,S as ee,q as C,p as te,K as le,N as ae,d as ne,u as ie,a9 as ue,o as re,i as se,j as oe,k as N,g as S,w as B,n as ce,bi as de,a_ as fe,bj as Q,bk as M,bl as me,f as ve,t as pe}from"./index.9a4cab8b.js";import{Q as ge,h as be}from"./QChip.8355376c.js";import{u as Fe,d as he,a as Se,c as ye,e as _e,j as xe,b as Ce,f as W}from"./QInput.c820a074.js";function k(e,s,b,c){const a=[];return e.forEach(r=>{c(r)===!0?a.push(r):s.push({failedPropValidation:b,file:r})}),a}function O(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),X(e)}const Ie={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},je=["rejected"];function ke({editable:e,dnd:s,getFileInput:b,addFilesToQueue:c}){const{props:a,emit:r,proxy:m}=G(),F=L(null),I=d(()=>a.accept!==void 0?a.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),j=d(()=>parseInt(a.maxFiles,10)),y=d(()=>parseInt(a.maxTotalSize,10));function x(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target!==null&&t.target.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&J(t);else{const g=b();g&&g!==t.target&&g.click(t)}}function v(t){e.value&&t&&c(null,t)}function P(t,g,z,A){let n=Array.from(g||t.target.files);const p=[],_=()=>{p.length!==0&&r("rejected",p)};if(a.accept!==void 0&&I.value.indexOf("*/")===-1&&(n=k(n,p,"accept",i=>I.value.some(o=>i.type.toUpperCase().startsWith(o)||i.name.toUpperCase().endsWith(o))),n.length===0))return _();if(a.maxFileSize!==void 0){const i=parseInt(a.maxFileSize,10);if(n=k(n,p,"max-file-size",o=>o.size<=i),n.length===0)return _()}if(a.multiple!==!0&&n.length!==0&&(n=[n[0]]),n.forEach(i=>{i.__key=i.webkitRelativePath+i.lastModified+i.name+i.size}),A===!0){const i=z.map(o=>o.__key);n=k(n,p,"duplicate",o=>i.includes(o.__key)===!1)}if(n.length===0)return _();if(a.maxTotalSize!==void 0){let i=A===!0?z.reduce((o,T)=>o+T.size,0):0;if(n=k(n,p,"max-total-size",o=>(i+=o.size,i<=y.value)),n.length===0)return _()}if(typeof a.filter=="function"){const i=a.filter(n);n=k(n,p,"filter",o=>i.includes(o))}if(a.maxFiles!==void 0){let i=A===!0?z.length:0;if(n=k(n,p,"max-files",()=>(i++,i<=j.value)),n.length===0)return _()}if(_(),n.length!==0)return n}function D(t){O(t),s.value!==!0&&(s.value=!0)}function u(t){X(t),(t.relatedTarget!==null||ee.is.safari!==!0?t.relatedTarget!==F.value:document.elementsFromPoint(t.clientX,t.clientY).includes(F.value)===!1)===!0&&(s.value=!1)}function E(t){O(t);const g=t.dataTransfer.files;g.length!==0&&c(null,g),s.value=!1}function R(t){if(s.value===!0)return C("div",{ref:F,class:`q-${t}__dnd absolute-full`,onDragenter:O,onDragover:O,onDragleave:u,onDrop:E})}return Object.assign(m,{pickFiles:x,addFiles:v}),{pickFiles:x,addFiles:v,onDragover:D,onDragleave:u,processFiles:P,getDndNode:R,maxFilesNumber:j,maxTotalSizeNumber:y}}var ze=te({name:"QFile",inheritAttrs:!1,props:{...Fe,...he,...Ie,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...Se,...je],setup(e,{slots:s,emit:b,attrs:c}){const{proxy:a}=G(),r=ye(),m=L(null),F=L(!1),I=_e(e),{pickFiles:j,onDragover:y,onDragleave:x,processFiles:v,getDndNode:P}=ke({editable:r.editable,dnd:F,getFileInput:w,addFilesToQueue:q}),D=xe(e),u=d(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),E=d(()=>W(u.value)),R=d(()=>u.value.map(l=>l.name).join(", ")),t=d(()=>be(u.value.reduce((l,f)=>l+f.size,0))),g=d(()=>({totalSize:t.value,filesNumber:u.value.length,maxFiles:e.maxFiles})),z=d(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:I.value,...c,id:r.targetUid.value,disabled:r.editable.value!==!0})),A=d(()=>"q-file q-field--auto-height"+(F.value===!0?" q-file--dnd":"")),n=d(()=>e.multiple===!0&&e.append===!0);function p(l){const f=u.value.slice();f.splice(l,1),i(f)}function _(l){const f=u.value.indexOf(l);f>-1&&p(f)}function i(l){b("update:modelValue",e.multiple===!0?l:l[0])}function o(l){l.keyCode===13&&ae(l)}function T(l){(l.keyCode===13||l.keyCode===32)&&j(l)}function w(){return m.value}function q(l,f){const h=v(l,f,u.value,n.value),U=w();U!=null&&(U.value=""),h!==void 0&&((e.multiple===!0?e.modelValue&&h.every(K=>u.value.includes(K)):e.modelValue===h[0])||i(n.value===!0?u.value.concat(h):h))}function V(){return[C("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function Y(){if(s.file!==void 0)return u.value.length===0?V():u.value.map((f,h)=>s.file({index:h,file:f,ref:this}));if(s.selected!==void 0)return u.value.length===0?V():s.selected({files:u.value,ref:this});if(e.useChips===!0)return u.value.length===0?V():u.value.map((f,h)=>C(ge,{key:"file-"+h,removable:r.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{p(h)}},()=>C("span",{class:"ellipsis",textContent:f.name})));const l=e.displayValue!==void 0?e.displayValue:R.value;return l.length!==0?[C("div",{class:e.inputClass,style:e.inputStyle,textContent:l})]:V()}function $(){const l={ref:m,...z.value,...D.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:q};return e.multiple===!0&&(l.multiple=!0),C("input",l)}return Object.assign(r,{fieldClass:A,emitValue:i,hasValue:E,inputRef:m,innerValue:u,floatingLabel:d(()=>E.value===!0||W(e.displayValue)),computedCounter:d(()=>{if(e.counterLabel!==void 0)return e.counterLabel(g.value);const l=e.maxFiles;return`${u.value.length}${l!==void 0?" / "+l:""} (${t.value})`}),getControlChild:()=>P("file"),getControl:()=>{const l={ref:r.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return r.editable.value===!0&&Object.assign(l,{onDragover:y,onDragleave:x,onKeydown:o,onKeyup:T}),C("div",l,[$()].concat(Y()))}}),Object.assign(a,{removeAtIndex:p,removeFile:_,getNativeElement:()=>m.value}),le(a,"nativeEl",()=>m.value),Ce(r)}});const Ae={class:"row justify-center q-mb-lg"},Ee={class:"image-md relative-position"},De=ne({__name:"PhotoUpload",props:{url:{},file:{}},emits:["update:url","update:file"],setup(e,{emit:s}){const b=e,c=s,a=d(()=>b.url||de),r=d(()=>b.file),m=ie(),F=L();ue(()=>{r.value&&(URL.revokeObjectURL(a.value),c("update:file",void 0))});const I=()=>{fe(F.value,"file input component is missing"),F.value.pickFiles()},j=y=>{c("update:file",y),y&&(URL.revokeObjectURL(a.value),c("update:url",URL.createObjectURL(y)))};return(y,x)=>(re(),se("div",Ae,[oe("div",Ee,[N(H,{src:a.value,fit:"cover",class:"image-md rounded-borders",alt:""},null,8,["src"]),N(S(ze),{ref_key:"fileInputRef",ref:F,class:"show-validation-errors-only q-mr-sm",accept:S(Q).join(", "),"model-value":r.value,"onUpdate:modelValue":x[0]||(x[0]=v=>j(v)),rules:[v=>!v||v.size<=S(M)||S(m).maxFileSize({max:(S(M)/1e6).toFixed(2)}),v=>!v||S(Q).includes(v.type)||S(m).allowedFilesAre({allowed:S(me).join(", ")})]},null,8,["accept","model-value","rules"]),N(ce,{class:"absolute-bottom-right-offset",icon:"upload",round:"",color:"primary",onClick:I,title:S(m).uploadImage},{default:B(()=>[N(Z,null,{default:B(()=>[ve(pe(S(m).uploadImage),1)]),_:1})]),_:1},8,["title"])])]))}});function Re(e){return new Promise((s,b)=>{const c=new FileReader;c.onloadend=()=>{let a=c.result;const r=a.indexOf("base64,");a=a.slice(r+7),s(a)},c.onerror=()=>{b("Failed to convert blob to base64.")},c.readAsDataURL(e)})}export{De as _,Re as b};
