import{Q as I}from"./QSpace.15764889.js";import{d as $,g as q,a as B,u as N,r as C,H as O,c as y,w as l,o as p,k as e,a5 as V,n as h,f as t,j as v,t as f,ah as k,aX as A,A as z,aY as F,aZ as W,aD as Y,a_ as j,i as S,aj as L,e as w,a$ as H,b0 as G,aB as K,aC as X,b1 as Z,b2 as J,az as E}from"./index.7ae99152.js";import{Q as c}from"./QCardSection.e04a19bd.js";import{Q as M}from"./QCard.ece06ff7.js";import{Q}from"./QDialog.8b440e78.js";import{C as x}from"./ClosePopup.7d4f9e25.js";import{_ as T}from"./ClickableCardItem.462f8540.js";import{B as R}from"./BigSpinner.eadc8dfc.js";import{b as ee}from"./browser.1a1bd576.js";import{Q as te}from"./QInput.23cad58c.js";import{Q as ae,o as le}from"./on-form-validation-error.f744f424.js";import{f as U,w as D}from"./currency.2af12bed.js";const oe={class:"text-center"},se={class:"text-h5 q-mb-sm"},ne={class:"text-body1 text-dark-gray q-mb-md"},re=$({__name:"ClientDineInCashPaymentModal",props:{orderId:{},modelValue:{type:Boolean}},emits:["close","update:modelValue"],setup(_,{emit:m}){const n=_,u=q(()=>n.modelValue),s=m,i=B(),d=N(),o=C(!1),a=C(!1);return O(u,()=>{!u.value||(o.value=!0,i.commit.sync(A({orderId:n.orderId})).then(()=>{a.value=!0}).catch(()=>{a.value=!1}).finally(()=>{o.value=!1}))},{immediate:!0}),(r,b)=>(p(),y(Q,{"model-value":u.value,"onUpdate:modelValue":b[0]||(b[0]=g=>s("update:modelValue",g))},{default:l(()=>[e(M,{class:"dialog-sm q-pb-md q-px-md"},{default:l(()=>[e(c,{class:"row items-center q-pb-none"},{default:l(()=>[e(I),V(e(h,{icon:"close",flat:"",round:"",dense:"",title:t(d).close},null,8,["title"]),[[x]])]),_:1}),o.value?(p(),y(R,{key:0})):a.value?(p(),y(c,{key:1},{default:l(()=>[v("div",oe,[v("p",se,f(t(d).waiterWasCalled),1),v("p",ne,f(t(d).waiterWillAcceptPayment),1),V(e(h,{label:t(d).ok,color:"primary",class:"q-mx-auto d-block"},null,8,["label"]),[[x]])])]),_:1})):k("",!0)]),_:1})]),_:1},8,["model-value"]))}}),ue={class:"text-center"},de={class:"text-h5 q-mb-lg"},ie=$({__name:"ClientTakeoutDeliveryCashPaymentModal",props:{modelValue:{type:Boolean}},emits:["close","update:modelValue"],setup(_,{emit:m}){const n=_,u=q(()=>n.modelValue),s=m,i=N();return(d,o)=>(p(),y(Q,{"model-value":u.value,"onUpdate:modelValue":o[0]||(o[0]=a=>s("update:modelValue",a))},{default:l(()=>[e(M,{class:"dialog-sm q-pb-md q-px-md"},{default:l(()=>[e(c,{class:"row items-center q-pb-none"},{default:l(()=>[e(I),V(e(h,{icon:"close",flat:"",round:"",dense:"",title:t(i).close},null,8,["title"]),[[x]])]),_:1}),e(c,null,{default:l(()=>[v("div",ue,[v("p",de,f(t(i).payInCashUponReceipt),1),V(e(h,{label:t(i).ok,color:"primary",class:"q-mx-auto d-block"},null,8,["label"]),[[x]])])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),me={key:0,class:"text-h4 text-center q-mb-md"},ce=$({__name:"PaymentCard",props:{orderNumber:{},method:{}},setup(_){const m=_,n=N(),u=C(!1),s=B(),i=q(()=>s.state.orders.paymentLink),d=C(),o=q(()=>{var r;return(r=s.state.auth.user.permissions)==null?void 0:r.client});z(async()=>{var r,b;(r=d.value)==null||r.replaceChildren(),u.value=!0;try{if(await a(),F("paymentLink:",i.value),W(i.value,"payment link was not received"),o.value)window.open(i.value,"_self");else try{const g=await ee.toCanvas(i.value,{errorCorrectionLevel:"M",version:14,width:280});(b=d.value)==null||b.appendChild(g)}catch(g){Y("QR code generation error:",g)}}finally{u.value=!1}});async function a(){return await s.commit.sync(j({orderNumber:m.orderNumber,method:m.method}))}return(r,b)=>(p(),S(L,null,[e(c,null,{default:l(()=>[u.value?k("",!0):(p(),S("p",me,f(o.value?t(n).waitForRedirect:t(n).scanQrCode),1))]),_:1}),e(c,null,{default:l(()=>[u.value?(p(),y(R,{key:0})):k("",!0),v("div",{ref_key:"qrCodeContainer",ref:d,class:"w-fit q-mx-auto"},null,512)]),_:1})],64))}}),pe=$({__name:"CreditCardOrBlikPaymentModal",props:{orderNumber:{},modelValue:{type:Boolean},method:{}},emits:["update:modelValue"],setup(_,{emit:m}){const n=_,u=m,s=N(),i=q(()=>n.modelValue);return(d,o)=>(p(),y(Q,{maximized:"","model-value":i.value,"onUpdate:modelValue":o[0]||(o[0]=a=>u("update:modelValue",a))},{default:l(()=>[e(M,{class:"q-pb-sm"},{default:l(()=>[e(c,{class:"row items-center q-pb-none"},{default:l(()=>[e(I),V(e(h,{icon:"close",flat:"",round:"",dense:"",size:"lg",title:t(s).close},null,8,["title"]),[[x]])]),_:1}),i.value?(p(),y(ce,{key:0,"order-number":d.orderNumber,method:d.method},null,8,["order-number","method"])):k("",!0)]),_:1})]),_:1},8,["model-value"]))}}),fe={class:"text-h5 text-center"},ve={class:"text-h5"},ye={class:"text-primary"},_e={class:"text-h5"},be={key:0,class:"text-primary"},Ce={key:1},ge=$({__name:"WaiterCashPaymentModal",props:{totalCost:{},orderNumber:{}},emits:["close","paid"],setup(_,{emit:m}){const n=_,u=m,s=N(),i=C(""),d=q(()=>Math.max(D(+i.value)-n.totalCost,0)),o=C(!1),a=B();async function r(){o.value=!0,a.commit.sync(G({orderNumber:n.orderNumber})).then(()=>{K.create({type:"positive",position:"top",timeout:X,message:s.value.paymentSuccess,multiLine:!0,group:!1}),u("close"),u("paid")}).finally(()=>{o.value=!1})}return(b,g)=>(p(),y(Q,null,{default:l(()=>[e(M,{class:"dialog-sm q-pb-md q-px-md"},{default:l(()=>[e(c,{class:"row items-center q-pb-none"},{default:l(()=>[e(I),V(e(h,{icon:"close",flat:"",round:"",dense:"",title:t(s).close},null,8,["title"]),[[x]])]),_:1}),e(c,null,{default:l(()=>[v("p",fe,f(t(s).payWithCash),1)]),_:1}),e(c,null,{default:l(()=>[v("p",ve,[w(f(t(s).totalToPay)+": ",1),v("span",ye,f(t(U)(b.totalCost)),1)])]),_:1}),e(ae,{onSubmit:r,onValidationError:t(le)},{default:l(()=>[e(c,null,{default:l(()=>[e(te,{modelValue:i.value,"onUpdate:modelValue":g[0]||(g[0]=P=>i.value=P),modelModifiers:{number:!0},"stack-label":"",label:`${t(s).amount} *`,hint:t(s).amountHint,"lazy-rules":"",type:"number",step:"0.01",rules:[P=>P!==""||t(s).fieldRequired,P=>t(D)(P)>=b.totalCost||t(s).minValue({min:t(U)(b.totalCost)})]},null,8,["modelValue","label","hint","rules"])]),_:1}),e(c,null,{default:l(()=>[v("p",_e,[w(f(t(s).change)+": ",1),d.value>0?(p(),S("span",be,f(t(U)(d.value)),1)):(p(),S("span",Ce,"-"))]),V(v("p",{class:"text-caption text-negative q-mt-xs"},f(t(s).makeSureChangeGiven),513),[[H,d.value>0]])]),_:1}),e(c,{align:"center"},{default:l(()=>[e(h,{color:"primary",type:"submit",class:"q-px-lg",loading:o.value},{default:l(()=>[w(f(t(s).pay),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["onValidationError"])]),_:1})]),_:1}))}}),Ve={class:"text-h5 text-center"},Be=$({__name:"PaymentMethodsModal",props:{totalCost:{},orderNumber:{},orderId:{},orderType:{}},setup(_){const m=N(),n=C(!1),u=C(!1),s=C("card"),i=B(),d=q(()=>{var o;return(o=i.state.auth.user.permissions)==null?void 0:o.client});return(o,a)=>(p(),S(L,null,[e(Q,Z(J(o.$attrs)),{default:l(()=>[e(M,{class:"dialog-sm q-pb-md q-px-md"},{default:l(()=>[e(c,{class:"row items-center q-pb-none"},{default:l(()=>[e(I),V(e(h,{icon:"close",flat:"",round:"",dense:"",title:t(m).close},null,8,["title"]),[[x]])]),_:1}),e(c,null,{default:l(()=>[v("p",Ve,f(t(m).selectPaymentMethod),1)]),_:1}),e(c,null,{default:l(()=>[e(T,{"image-src":"/images/cash.svg",onClick:a[0]||(a[0]=r=>n.value=!0)},{text:l(()=>[w(f(t(m).cash),1)]),_:1}),e(T,{class:"q-mt-lg","image-src":"/images/credit-card.svg",onClick:a[1]||(a[1]=r=>{s.value="card",u.value=!0})},{text:l(()=>[w(f(t(m).creditCard),1)]),_:1}),e(T,{class:"q-mt-lg","image-src":"/images/blik.png",onClick:a[2]||(a[2]=r=>{s.value="blik",u.value=!0})},{text:l(()=>[w(f(t(m).blik),1)]),_:1})]),_:1})]),_:1})]),_:1},16),d.value?k("",!0):(p(),y(ge,{key:0,modelValue:n.value,"onUpdate:modelValue":a[3]||(a[3]=r=>n.value=r),onClose:a[4]||(a[4]=r=>n.value=!1),"total-cost":o.totalCost,"order-number":o.orderNumber},null,8,["modelValue","total-cost","order-number"])),d.value&&o.orderType===t(E).DINE_IN?(p(),y(re,{key:1,modelValue:n.value,"onUpdate:modelValue":a[5]||(a[5]=r=>n.value=r),onClose:a[6]||(a[6]=r=>n.value=!1),"order-id":o.orderId},null,8,["modelValue","order-id"])):k("",!0),d.value&&(o.orderType===t(E).TAKEOUT||o.orderType===t(E).DELIVERY)?(p(),y(ie,{key:2,modelValue:n.value,"onUpdate:modelValue":a[7]||(a[7]=r=>n.value=r),onClose:a[8]||(a[8]=r=>n.value=!1)},null,8,["modelValue"])):k("",!0),e(pe,{modelValue:u.value,"onUpdate:modelValue":a[9]||(a[9]=r=>u.value=r),"order-number":o.orderNumber,method:s.value},null,8,["modelValue","order-number","method"])],64))}});export{Be as _,ge as a};
