import{Q as N}from"./QInput.97ac7230.js";import{d as y,h as U,a8 as F,u as O,H as P,i as v,aj as R,ai as j,o as n,j as B,t as k,g as e,ah as m,e as c,w as s,k as r,f as Q,n as _,Q as J,a as G,c as X,r as g,bh as K,bM as Y,bN as Z,bO as E,aB as ee,aC as le,bP as q}from"./index.a126600a.js";import{a as ae,Q as oe}from"./QItemLabel.1516e609.js";import{Q as te}from"./QSelect.e10a3d47.js";import{Q as ie}from"./QToggle.26daf8b4.js";import{Q as ne}from"./QCardSection.d6ff5594.js";import{Q as re}from"./QCard.8a4076b7.js";import{Q as se,o as ue}from"./on-form-validation-error.3a67f6d8.js";import{u as me,C as de,B as pe}from"./BigSpinner.fc8e9630.js";import{_ as ce}from"./AddAddressModal.8e8ebe6c.js";import{C as A}from"./CommonTooltip.e6619835.js";import{_ as fe}from"./EmailInput.a5365ffe.js";import{_ as ke}from"./PhoneInput.c7afa62a.js";import{d as p}from"./dayjs.min.78c0669c.js";import{f as L}from"./address.b5e3391c.js";import{_ as ve}from"./BackButton.fdebd4fb.js";import"./use-dark.63544f33.js";import"./focus-manager.05708ea9.js";import"./QChip.f106a3d2.js";import"./QMenu.ad914f3b.js";import"./position-engine.033336f2.js";import"./portal.efabcbd8.js";import"./QDialog.e2f87206.js";import"./focusout.9e4b7403.js";import"./use-checkbox.7bb8a46a.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QSpace.9eece2ea.js";import"./ClosePopup.836797ed.js";import"./capitalize.b0e9fa3f.js";const ge={class:"work-schedule-entry-left row items-center gap-sm no-wrap"},be={class:"work-schedule-day-of-week"},Se={key:0,class:"text-dark-gray text-no-wrap"},_e={key:3},Ve={key:0,class:"work-schedule-entry-right row items-center no-wrap gap-sm"},Te={key:0,class:"text-dark-gray text-no-wrap"},we={key:4},He=y({__name:"WorkSchedule",props:{schedule:{}},emits:["updateSchedule"],setup(x,{emit:u}){const V=x,T=u,b=U(()=>V.schedule),d=F([]),o=O();return P(d,()=>{T("updateSchedule",d)}),P(b,()=>{JSON.stringify(b.value)!==JSON.stringify(d)&&d.splice(0,d.length,...b.value)},{immediate:!0}),(w,H)=>(n(),v("div",null,[(n(!0),v(R,null,j(d,(l,S)=>(n(),v("div",{key:S,class:"work-schedule-entry no-wrap"},[B("div",ge,[B("div",be,k(e(o)[`dayOfWeekShort${l.dayOfWeek}`]),1),l.openingTime==null?(n(),v("p",Se,k(e(o).weekend),1)):m("",!0),l.openingTime==null?(n(),c(_,{key:1,flat:"",dense:"",color:"primary",icon:"add",onClick:a=>{l.openingTime="",l.closingTime=""},title:e(o).addWorkTime},{default:s(()=>[r(A,null,{default:s(()=>[Q(k(e(o).addWorkTime),1)]),_:1})]),_:2},1032,["onClick","title"])):m("",!0),l.openingTime!=null?(n(),c(N,{key:2,"hide-bottom-space":"","no-error-icon":"","lazy-rules":"",dense:"",modelValue:l.openingTime,"onUpdate:modelValue":a=>l.openingTime=a,mask:"time","reactive-rules":"",rules:["time",a=>!!a||e(o).fieldRequired,a=>!e(p)(l.closingTime,"HH:mm",!0).isValid()||e(p)(a,"HH:mm").isBefore(e(p)(l.closingTime,"HH:mm"))||e(o).openingTimeBeforeClosing,a=>!e(p)(l.breakStart,"HH:mm",!0).isValid()||e(p)(a,"HH:mm").isBefore(e(p)(l.breakStart,"HH:mm"))||e(o).openingTimeBeforeBreakStart]},null,8,["modelValue","onUpdate:modelValue","rules"])):m("",!0),l.openingTime!=null?(n(),v("span",_e,"\u2014")):m("",!0),l.openingTime!=null?(n(),c(N,{key:4,"hide-bottom-space":"","no-error-icon":"","lazy-rules":"",dense:"",modelValue:l.closingTime,"onUpdate:modelValue":a=>l.closingTime=a,mask:"time",rules:["time",a=>!!a||e(o).fieldRequired]},null,8,["modelValue","onUpdate:modelValue","rules"])):m("",!0),l.openingTime!=null?(n(),c(_,{key:5,flat:"",dense:"",color:"negative",icon:"close",onClick:a=>{l.openingTime=null,l.closingTime=null},title:e(o).removeWorkTime},{default:s(()=>[r(A,null,{default:s(()=>[Q(k(e(o).removeWorkTime),1)]),_:1})]),_:2},1032,["onClick","title"])):m("",!0)]),l.openingTime!=null?(n(),v("div",Ve,[l.breakStart==null?(n(),v("p",Te,k(e(o).noLunchBreak),1)):m("",!0),l.breakStart==null?(n(),c(_,{key:1,flat:"",dense:"",color:"primary",icon:"add",onClick:a=>{l.breakStart="",l.breakEnd=""},title:e(o).addLunchBreak},{default:s(()=>[r(A,null,{default:s(()=>[Q(k(e(o).addLunchBreak),1)]),_:1})]),_:2},1032,["onClick","title"])):m("",!0),l.breakStart!=null?(n(),c(J,{key:2,name:"o_restaurant_menu",style:{"font-size":"22px"},class:"q-pl-sm"})):m("",!0),l.breakStart!=null?(n(),c(N,{key:3,"reactive-rules":"","hide-bottom-space":"","no-error-icon":"","lazy-rules":"",dense:"",modelValue:l.breakStart,"onUpdate:modelValue":a=>l.breakStart=a,mask:"time",rules:["time",a=>!!a||e(o).fieldRequired,a=>!e(p)(l.breakEnd,"HH:mm",!0).isValid()||e(p)(a,"HH:mm").isBefore(e(p)(l.breakEnd,"HH:mm"))||e(o).breakStartBeforeEnd]},null,8,["modelValue","onUpdate:modelValue","rules"])):m("",!0),l.breakStart!=null?(n(),v("span",we,"\u2014")):m("",!0),l.breakStart!=null?(n(),c(N,{key:5,"hide-bottom-space":"","no-error-icon":"","lazy-rules":"",dense:"","reactive-rules":"",modelValue:l.breakEnd,"onUpdate:modelValue":a=>l.breakEnd=a,mask:"time",rules:["time",a=>!!a||e(o).fieldRequired,a=>!e(p)(l.closingTime,"HH:mm",!0).isValid()||e(p)(a,"HH:mm").isBefore(e(p)(l.closingTime,"HH:mm"))||e(o).breakEndBeforeClosing]},null,8,["modelValue","onUpdate:modelValue","rules"])):m("",!0),l.breakStart!=null?(n(),c(_,{key:6,flat:"",dense:"",color:"negative",icon:"close",onClick:a=>{l.breakStart=null,l.breakEnd=null},title:e(o).removeLunchBreak},{default:s(()=>[r(A,null,{default:s(()=>[Q(k(e(o).removeLunchBreak),1)]),_:1})]),_:2},1032,["onClick","title"])):m("",!0)])):m("",!0)]))),128))]))}}),Ce={class:"max-w-md q-mx-auto"},Be={class:"q-mb-sm"},Qe={class:"row justify-end q-gutter-sm q-mt-md"},ol=y({__name:"AdminCreateUpdateSalePoint",setup(x){const u=O(),V=G(),T=X(),b=g(!1),d=g(""),o=g(""),w=g(""),H=g(!1),l=g(),S=g(Array(7).fill(null).map((C,t)=>({openingTime:t===6?null:"",closingTime:t===6?null:"",breakStart:null,breakEnd:null,dayOfWeek:(t+1)%7}))),a=g(!1),$=U(()=>T.currentRoute.value.params.id),f=U(()=>$.value?V.state.salePoints.salePoints.find(C=>C.id===$.value):void 0),h=U(()=>$.value&&!f.value?[de.SALE_POINTS]:[]);let I=me(h,{store:V});const W=U(()=>[L(l.value)].filter(Boolean)),z=(C,t)=>{t(()=>{})},M=K(()=>{f.value?(d.value=f.value.name,w.value=f.value.email,o.value=f.value.phone,l.value=f.value.address,H.value=f.value.isDefault,S.value=f.value.workSchedule.slice().map(C=>({...C})),M()):$.value&&V.state.salePoints.salePoints.length&&T.push("/404")},{flush:"post"}),D=async()=>{b.value=!0,V.commit.sync(f.value?Y({salePoint:{id:f.value.id,name:d.value,address:l.value,email:w.value,workSchedule:S.value,isDefault:H.value,phone:o.value}}):Z({salePoint:{id:E(),name:d.value,address:l.value,email:w.value,workSchedule:S.value,isDefault:H.value,phone:o.value}})).then(()=>{ee.create({type:"positive",position:"top",timeout:le,message:f.value?u.value.updateSuccess:u.value.createSuccess,multiLine:!0,group:!1}),T.push("/admin/sale-points")}).finally(()=>{b.value=!1})};return(C,t)=>(n(),v(R,null,[B("div",Ce,[r(ve),e(I)?(n(),c(pe,{key:0})):(n(),c(se,{key:1,onSubmit:D,onValidationError:e(ue)},{default:s(()=>[r(re,{class:"q-pa-md"},{default:s(()=>[r(ne,{class:"q-gutter-lg"},{default:s(()=>[r(N,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=i=>d.value=i),modelModifiers:{trim:!0},"stack-label":"",label:`${e(u).salePointNameLabel} *`,"lazy-rules":"",type:"text",rules:[i=>!!i&&i.length>0||e(u).fieldRequired,i=>i.length<=e(q)||e(u).maxLength({max:e(q)})]},null,8,["modelValue","label","rules"]),r(fe,{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=i=>w.value=i)},null,8,["modelValue"]),r(ke,{modelValue:o.value,"onUpdate:modelValue":t[2]||(t[2]=i=>o.value=i),shouldValidateFormat:""},null,8,["modelValue"]),r(te,{"model-value":e(L)(l.value),"use-input":"","fill-input":"","stack-label":"","hide-selected":"","input-debounce":"0",options:W.value,onFilter:z,label:`${e(u).address} *`,rules:[i=>!!i&&i.length>0||e(u).fieldRequired]},{after:s(()=>[r(_,{round:"",dense:"",icon:"add",color:"primary",onClick:t[3]||(t[3]=i=>a.value=!0),title:e(u).addNewAddress},{default:s(()=>[r(A,null,{default:s(()=>[Q(k(e(u).addNewAddress),1)]),_:1})]),_:1},8,["title"])]),"no-option":s(()=>[r(ae,null,{default:s(()=>[r(oe,null,{default:s(()=>[Q(k(e(u).noResults),1)]),_:1})]),_:1})]),_:1},8,["model-value","options","label","rules"]),r(ie,{modelValue:H.value,"onUpdate:modelValue":t[4]||(t[4]=i=>H.value=i),label:e(u).isDefault,size:"lg","left-label":""},null,8,["modelValue","label"]),B("div",null,[B("p",Be,k(e(u).workSchedule),1),r(He,{schedule:S.value,onUpdateSchedule:t[5]||(t[5]=i=>S.value=i)},null,8,["schedule"])])]),_:1})]),_:1}),B("div",Qe,[r(_,{label:e(u).cancel,onClick:t[6]||(t[6]=()=>e(T).back()),color:"dark",flat:""},null,8,["label"]),r(_,{label:e(u).save,loading:b.value,type:"submit",color:"primary"},null,8,["label","loading"])])]),_:1},8,["onValidationError"]))]),a.value?(n(),c(ce,{key:0,modelValue:a.value,"onUpdate:modelValue":t[7]||(t[7]=i=>a.value=i),onSubmit:t[8]||(t[8]=i=>(a.value=!1,l.value=i))},null,8,["modelValue"])):m("",!0)],64))}});export{ol as default};
