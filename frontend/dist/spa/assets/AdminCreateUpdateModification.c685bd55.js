import{Q as g}from"./QInput.e35961c4.js";import{Q as U}from"./QCardSection.ef6e6dbe.js";import{Q as B}from"./QCard.5aa3fe54.js";import{d as F,u as R,a as Q,c as q,r as u,h as I,bg as D,i as L,k as i,g as a,e as y,w as _,aA as C,aD as $,bt as z,bu as H,aB as G,o as M,bv as V,bw as S,bx as E,by as N,bz as T,j as W,n as A}from"./index.1c3783dc.js";import{Q as X,o as j}from"./on-form-validation-error.73894483.js";import{u as P,C as J,B as K}from"./BigSpinner.fa6acb5e.js";import{w as O,a as Y}from"./currency.2af12bed.js";import{_ as Z}from"./BackButton.862284a1.js";import{b as ee,_ as ae}from"./blob-to-base64.229370b4.js";import"./use-dark.af62a438.js";import"./focus-manager.05708ea9.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QTooltip.a983157c.js";import"./position-engine.748a335e.js";import"./QImg.7b74f12e.js";import"./QChip.71405c2d.js";const le={class:"max-w-md q-mx-auto"},te={class:"row justify-end q-gutter-sm q-mt-md"},ye=F({__name:"AdminCreateUpdateModification",setup(oe){const l=R(),d=Q(),c=q(),b=u(!1),r=u(""),p=u(""),f=u(),n=u(""),m=u(""),v=I(()=>c.currentRoute.value.params.id),o=I(()=>v.value?d.state.modifications.modifications.find(s=>s.id===v.value):void 0),w=I(()=>v.value&&!o.value?[J.MODIFICATIONS]:[]);let x=P(w,{store:d});const k=D(()=>{o.value?(r.value=o.value.name,p.value=o.value.imageUrl,n.value=Y(o.value.price),m.value=o.value.weight,k()):v.value&&d.state.modifications.modifications.length&&c.push("/404")},{flush:"post"}),h=async()=>{let s="";try{p.value&&f.value&&(s=await ee(f.value))}catch{C.create({type:"negative",position:"top",timeout:$,message:l.value.imageCorrupted,multiLine:!0,group:!1});return}b.value=!0,d.commit.sync(o.value?z({id:o.value.id,name:r.value,price:O(+n.value||0),imageBase64:s,weight:+m.value||0}):H({name:r.value,price:O(+n.value||0),imageBase64:s,weight:+m.value||0})).then(()=>{C.create({type:"positive",position:"top",timeout:G,message:o.value?l.value.updateSuccess:l.value.createSuccess,multiLine:!0,group:!1}),c.push("/admin/modifications")}).finally(()=>{b.value=!1})};return(s,t)=>(M(),L("div",le,[i(Z),a(x)?(M(),y(K,{key:0})):(M(),y(X,{key:1,onSubmit:h,onValidationError:a(j)},{default:_(()=>[i(B,{class:"q-pa-md"},{default:_(()=>[i(U,{class:"q-gutter-lg"},{default:_(()=>[i(ae,{url:p.value,"onUpdate:url":t[0]||(t[0]=e=>p.value=e),file:f.value,"onUpdate:file":t[1]||(t[1]=e=>f.value=e)},null,8,["url","file"]),i(g,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=e=>r.value=e),modelModifiers:{trim:!0},"stack-label":"",label:`${a(l).modificationNameLabel} *`,"lazy-rules":"",type:"text",rules:[e=>!!e&&e.length>0||a(l).fieldRequired,e=>e.length<=a(V)||a(l).maxLength({max:a(V)})]},null,8,["modelValue","label","rules"]),i(g,{modelValue:n.value,"onUpdate:modelValue":t[3]||(t[3]=e=>n.value=e),modelModifiers:{number:!0},"stack-label":"",label:`${a(l).price} *`,"lazy-rules":"",type:"number",step:"0.01",rules:[e=>e!==""||a(l).fieldRequired,e=>e<=a(S)||a(l).maxValue({max:a(S)}),e=>e>=a(E)||a(l).minValue({min:a(E)})]},null,8,["modelValue","label","rules"]),i(g,{modelValue:m.value,"onUpdate:modelValue":t[4]||(t[4]=e=>m.value=e),modelModifiers:{number:!0},"stack-label":"",label:`${a(l).weight} *`,"lazy-rules":"",type:"number",step:"1",rules:[e=>e!==""||a(l).fieldRequired,e=>e<=a(N)||a(l).maxValue({max:a(N)}),e=>e>=a(T)||a(l).minValue({min:a(T)})]},null,8,["modelValue","label","rules"])]),_:1})]),_:1}),W("div",te,[i(A,{label:a(l).cancel,onClick:t[5]||(t[5]=()=>a(c).back()),color:"dark",flat:""},null,8,["label"]),i(A,{label:a(l).save,loading:b.value,type:"submit",color:"primary"},null,8,["label","loading"])])]),_:1},8,["onValidationError"]))]))}});export{ye as default};
