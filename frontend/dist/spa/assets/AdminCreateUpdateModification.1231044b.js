import{Q as g}from"./QInput.d273f137.js";import{Q as U}from"./QCardSection.d7b866b7.js";import{Q as B}from"./QCard.da8ab5ea.js";import{d as F,u as R,a as Q,c as q,r as u,h as I,bh as D,i as L,k as i,g as a,e as C,w as _,aB as y,aE as $,bu as z,bv as H,aC as G,o as M,bw as V,bx as E,by as S,bz as N,bA as T,j as W,n as A}from"./index.075e99e0.js";import{Q as X,o as j}from"./on-form-validation-error.38a698e4.js";import{u as P,C as J,B as K}from"./BigSpinner.d1dc21cc.js";import{w as O,a as Y}from"./currency.2af12bed.js";import{_ as Z}from"./BackButton.2f3409d4.js";import{b as ee,_ as ae}from"./blob-to-base64.5717ef63.js";import"./use-dark.31d3c707.js";import"./focus-manager.05708ea9.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./CommonTooltip.5087a5f7.js";import"./position-engine.a14d791b.js";import"./portal.7cc4eb97.js";import"./QImg.736da0cd.js";import"./QChip.1b1524a9.js";const le={class:"max-w-md q-mx-auto"},te={class:"row justify-end q-gutter-sm q-mt-md"},ye=F({__name:"AdminCreateUpdateModification",setup(oe){const l=R(),d=Q(),p=q(),b=u(!1),r=u(""),c=u(""),f=u(),n=u(""),m=u(""),v=I(()=>p.currentRoute.value.params.id),o=I(()=>v.value?d.state.modifications.modifications.find(s=>s.id===v.value):void 0),w=I(()=>v.value&&!o.value?[J.MODIFICATIONS]:[]);let x=P(w,{store:d});const h=D(()=>{o.value?(r.value=o.value.name,c.value=o.value.imageUrl,n.value=Y(o.value.price),m.value=o.value.weight,h()):v.value&&d.state.modifications.modifications.length&&p.push("/404")},{flush:"post"}),k=async()=>{let s="";try{c.value&&f.value&&(s=await ee(f.value))}catch{y.create({type:"negative",position:"top",timeout:$,message:l.value.imageCorrupted,multiLine:!0,group:!1});return}b.value=!0,d.commit.sync(o.value?z({id:o.value.id,name:r.value,price:O(+n.value||0),imageBase64:s,weight:+m.value||0}):H({name:r.value,price:O(+n.value||0),imageBase64:s,weight:+m.value||0})).then(()=>{y.create({type:"positive",position:"top",timeout:G,message:o.value?l.value.updateSuccess:l.value.createSuccess,multiLine:!0,group:!1}),p.push("/admin/modifications")}).finally(()=>{b.value=!1})};return(s,t)=>(M(),L("div",le,[i(Z),a(x)?(M(),C(K,{key:0})):(M(),C(X,{key:1,onSubmit:k,onValidationError:a(j)},{default:_(()=>[i(B,{class:"q-pa-md"},{default:_(()=>[i(U,{class:"q-gutter-lg"},{default:_(()=>[i(ae,{url:c.value,"onUpdate:url":t[0]||(t[0]=e=>c.value=e),file:f.value,"onUpdate:file":t[1]||(t[1]=e=>f.value=e)},null,8,["url","file"]),i(g,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=e=>r.value=e),modelModifiers:{trim:!0},"stack-label":"",label:`${a(l).modificationNameLabel} *`,"lazy-rules":"",type:"text",rules:[e=>!!e&&e.length>0||a(l).fieldRequired,e=>e.length<=a(V)||a(l).maxLength({max:a(V)})]},null,8,["modelValue","label","rules"]),i(g,{modelValue:n.value,"onUpdate:modelValue":t[3]||(t[3]=e=>n.value=e),modelModifiers:{number:!0},"stack-label":"",label:`${a(l).price} *`,"lazy-rules":"",type:"number",step:"0.01",rules:[e=>e!==""||a(l).fieldRequired,e=>e<=a(E)||a(l).maxValue({max:a(E)}),e=>e>=a(S)||a(l).minValue({min:a(S)})]},null,8,["modelValue","label","rules"]),i(g,{modelValue:m.value,"onUpdate:modelValue":t[4]||(t[4]=e=>m.value=e),modelModifiers:{number:!0},"stack-label":"",label:`${a(l).weight} *`,"lazy-rules":"",type:"number",step:"1",rules:[e=>e!==""||a(l).fieldRequired,e=>e<=a(N)||a(l).maxValue({max:a(N)}),e=>e>=a(T)||a(l).minValue({min:a(T)})]},null,8,["modelValue","label","rules"])]),_:1})]),_:1}),W("div",te,[i(A,{label:a(l).cancel,onClick:t[5]||(t[5]=()=>a(p).back()),color:"dark",flat:""},null,8,["label"]),i(A,{label:a(l).save,loading:b.value,type:"submit",color:"primary"},null,8,["label","loading"])])]),_:1},8,["onValidationError"]))]))}});export{ye as default};
