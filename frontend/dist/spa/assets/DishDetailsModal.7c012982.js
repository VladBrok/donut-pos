import{Q as M}from"./QSpace.c26d846a.js";import{u as I,d as B,h as H,o as a,e as g,w as n,af as D,j as u,k as d,i as w,t as h,ac as f,f as k,g as v,m as R,r as S,n as T,c4 as U,bS as j,a as F,H as L,a5 as z,ae as E,ad as V,aQ as G,bJ as W}from"./index.92b1981f.js";import{Q as C}from"./QCardSection.6b30cd69.js";import{Q as J}from"./NoData.b4eb18ee.js";import{Q as P}from"./QCard.05af6174.js";import{Q as K}from"./QDialog.cd420016.js";import{C as N}from"./ClosePopup.0403f3f3.js";import{Q as q}from"./QTooltip.320304f6.js";import{s as X}from"./sanitize-html.328c4bb3.js";import{Q as Y}from"./QImg.d5d2e26d.js";import{f as Z}from"./currency.2af12bed.js";import{_ as ee}from"./ProductCounter.d6f95ba1.js";function te(l){const i=I();return`${l} ${i.value.weightGram}`}function ie(l,i){if(i<=0)throw new Error(`Max length ${i} should be > 0`);return l.length<=i?l:l.slice(0,i)+"..."}const oe={class:"column no-wrap full-height"},ne={key:0,class:"absolute-full text-h6 flex flex-center"},se={class:"row justify-between q-px-md"},ae={class:"text-body2 text-dark-gray"},re={key:0,class:"text-primary"},x=B({__name:"ProductCard",props:{price:{},weight:{},name:{},imageUrl:{},noShadow:{type:Boolean},textSize:{},caption:{}},setup(l){const i=l,o=H(()=>({"text-h5":!i.textSize||i.textSize==="lg","text-h6":i.textSize==="sm"}));return(t,m)=>(a(),g(P,{class:D([{"shadow-0":t.noShadow},"full-height"])},{default:n(()=>[u("div",oe,[d(C,null,{default:n(()=>[d(Y,{src:t.imageUrl,alt:"",fit:"cover",class:"image-card shadow-3 rounded-borders product-card-image"},{default:n(()=>[t.caption?(a(),w("div",ne,h(t.caption),1)):f("",!0)]),_:1},8,["src"])]),_:1}),u("div",se,[u("div",{class:D(["q-mr-sm",o.value])},[u("div",null,[k(h(t.textSize==="sm"?v(ie)(t.name,20):t.name)+" ",1),t.textSize==="sm"?(a(),g(q,{key:0},{default:n(()=>[k(h(t.name),1)]),_:1})):f("",!0)]),u("div",ae,h(v(te)(t.weight)),1)],2),u("div",{class:D(["flex-grow text-right",o.value])},[t.price?(a(),w("span",re,h(v(Z)(t.price)),1)):f("",!0),R(t.$slots,"right")],2)]),R(t.$slots,"default")])]),_:3},8,["class"]))}}),de=u("span",{class:"text-h5 q-pr-sm"},"+",-1),le=u("span",{class:"text-h5"},"+",-1),ce=["innerHTML"],ue={key:0},me=B({__name:"DishCard",props:{dish:{},expanded:{type:Boolean},hidePrice:{type:Boolean},count:{}},emits:["openDetailsClick","addClick"],setup(l,{emit:i}){const o=i,t=S(),m=I();return(e,r)=>(a(),w("div",{ref_key:"containerRef",ref:t},[d(x,{"no-shadow":e.expanded,"image-url":e.dish.imageUrl,price:e.hidePrice?void 0:e.dish.price,weight:e.dish.weight,name:e.dish.name,caption:e.dish.isActive?void 0:v(m).outOfStock},{right:n(()=>[e.count!=null?(a(),w("span",ue," x "+h(e.count),1)):f("",!0)]),default:n(()=>[e.expanded?f("",!0):(a(),g(C,{key:0,class:"q-mt-auto row justify-end"},{default:n(()=>[e.dish.isActive?(a(),g(T,{key:0,color:"primary","icon-right":"shopping_basket",padding:"0 sm",class:"q-mr-md",onClick:r[0]||(r[0]=p=>o("openDetailsClick"))},{default:n(()=>[de,d(q,null,{default:n(()=>[k(h(v(m).openDetails),1)]),_:1})]),_:1})):f("",!0),e.dish.isActive?(a(),g(T,{key:1,color:"primary",padding:"0 sm",outline:"",onClick:r[1]||(r[1]=p=>o("addClick",t.value))},{default:n(()=>[le,d(q,null,{default:n(()=>[k(h(v(m).addToCurrentOrder),1)]),_:1})]),_:1})):f("",!0)]),_:1})),e.expanded&&e.dish.description?(a(),g(C,{key:1},{default:n(()=>[u("div",{class:"text-body1",innerHTML:v(X)(e.dish.description)},null,8,ce)]),_:1})):f("",!0)]),_:1},8,["no-shadow","image-url","price","weight","name","caption"])],512))}});function pe({timing:l,draw:i,duration:o}){const t=performance.now();requestAnimationFrame(function m(e){let r=(e-t)/o;r>1&&(r=1);const p=l(r);i(p),r<1&&requestAnimationFrame(m)})}function fe(l,i,o){if(o){const t=o.querySelector(".product-card-image"),m=t==null?void 0:t.cloneNode(!0);if(t&&m){const e=m;e.style.position="absolute",document.body.appendChild(e);const r=t.getBoundingClientRect().left+document.documentElement.scrollLeft+10,p=t.getBoundingClientRect().top+document.documentElement.scrollTop-10,$=document.querySelector(".shopping-basket"),b=$.getBoundingClientRect().left+document.documentElement.scrollLeft+10-r,O=$.getBoundingClientRect().top+document.documentElement.scrollTop-10-p,s=t.getBoundingClientRect().width,c=t.getBoundingClientRect().height,_=s/4-s,Q=c/4-c;e.style.left=`${r}px`,e.style.top=`${p}px`,e.style.width=`${t.getBoundingClientRect().width}px`,e.style.height=`${t.getBoundingClientRect().height}px`,e.style.zIndex="9999",pe({duration:j,timing:y=>y,draw:y=>{var A;e.style.left=`${r+b*y}px`,e.style.top=`${p+O*y}px`,e.style.width=`${s+_*y}px`,e.style.height=`${c+Q*y}px`,e.style.opacity=(A=Math.max(1-y,.1))==null?void 0:A.toString(),y>=1&&e.remove()}})}}l.commit.crossTab(U({dish:i}))}const he=B({__name:"ModificationCard",props:{modification:{},hidePrice:{type:Boolean}},setup(l){return(i,o)=>(a(),g(x,{"image-url":i.modification.imageUrl,price:i.hidePrice?void 0:i.modification.price,name:i.modification.name,weight:i.modification.weight,"text-size":"sm"},{default:n(()=>[d(C,{class:"q-mt-auto row justify-end"},{default:n(()=>[R(i.$slots,"default")]),_:3})]),_:3},8,["image-url","price","name","weight"]))}}),ge={class:"text-weight-bold text-h5"},ve={class:"q-mt-sm row"},Qe=B({__name:"DishDetailsModal",props:{dish:{},viewOnly:{type:Boolean},count:{}},setup(l){const i=l,o=H(()=>i.dish),t=I(),m=F(),e=S(new Map),r=S(),p=S();L(o,()=>{var s;e.value.clear(),(s=o.value)==null||s.modifications.forEach(c=>{e.value.set(c.id,(c==null?void 0:c.count)||0)})},{immediate:!0});function $(s){e.value.set(s,(e.value.get(s)||0)-1)}function b(s){e.value.set(s,(e.value.get(s)||0)+1)}function O(){G(o.value,"Expected to have a dish at this point"),p.value="fade",setTimeout(()=>{p.value=void 0},300);const s={cookedDate:"",cookingDate:"",deliveredDate:"",status:"",count:1,dishIdInOrder:W(),...o.value,modifications:o.value.modifications.filter(c=>e.value.get(c.id)).map(c=>({...c,count:e.value.get(c.id)||-1}))};fe(m,s,r.value)}return(s,c)=>(a(),g(K,{"transition-hide":p.value},{default:n(()=>[d(P,{class:"dialog-md"},{default:n(()=>[d(C,{class:"row items-center q-pb-none"},{default:n(()=>[d(M),z(d(T,{icon:"close",flat:"",round:"",dense:""},null,512),[[N]])]),_:1}),o.value?(a(),w("div",{key:0,class:"row scroll restricted-height-modal",ref_key:"dishContainerRef",ref:r},[u("div",{class:D(["col-12 col-sm-6",{"q-mx-auto":!o.value.modifications.length}])},[d(me,{dish:o.value,expanded:"","hide-price":s.viewOnly,count:s.count},null,8,["dish","hide-price","count"])],2),o.value.modifications.length?(a(),g(C,{key:0,class:"col-12 col-sm-6"},{default:n(()=>[u("div",ge,h(v(t).modificationsTitle)+": ",1),u("div",ve,[(a(!0),w(E,null,V(o.value.modifications,_=>(a(),w("div",{key:_.id,class:"col-12 col-md-6 q-pa-sm"},[d(he,{modification:_,"hide-price":s.viewOnly},{default:n(()=>[d(ee,{"view-only":s.viewOnly,count:e.value.get(_.id)||0,onIncrement:Q=>b(_.id),onDecrement:Q=>$(_.id)},null,8,["view-only","count","onIncrement","onDecrement"])]),_:2},1032,["modification","hide-price"])]))),128))])]),_:1})):f("",!0)],512)):f("",!0),s.viewOnly?f("",!0):(a(),w(E,{key:1},[d(J),d(C,{class:"row"},{default:n(()=>[d(M),z((a(),g(T,{color:"primary",onClick:O},{default:n(()=>[k(h(v(t).addToOrderButton),1)]),_:1})),[[N]])]),_:1})],64))]),_:1})]),_:1},8,["transition-hide"]))}});export{Qe as _,me as a,fe as b};
