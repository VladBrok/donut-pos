import{Q as I}from"./QSpace.c26d846a.js";import{d as $,h as Q,a as T,u as P,r as C,H as A,o as i,e as y,w as t,aO as z,k as e,a5 as h,n as g,j as v,t as p,g as l,ac as V,A as F,aP as W,aQ as H,ay as Y,aR as j,i as q,ae as O,f as w,m as G,ai as K,aS as J,aT as X,aw as Z,ax as ee,aU as te,aV as ae,au as E}from"./index.92b1981f.js";import{Q as f}from"./QCardSection.6b30cd69.js";import{Q as N}from"./QCard.05af6174.js";import{Q as M}from"./QDialog.cd420016.js";import{C as x}from"./ClosePopup.0403f3f3.js";import{B as D}from"./BigSpinner.23930169.js";import{b as le}from"./browser.1a1bd576.js";import{Q as oe}from"./QImg.d5d2e26d.js";import{a as L,b as se,Q as re}from"./QItemLabel.e8e8f6f6.js";import{Q as ne}from"./QList.8f8ed760.js";import{Q as ue}from"./QInput.7bd0947e.js";import{Q as de,o as me}from"./on-form-validation-error.f0562acd.js";import{w as R,f as U}from"./currency.2af12bed.js";const ie={class:"text-center"},ce={class:"text-h5 q-mb-sm"},pe={class:"text-body1 text-dark-gray q-mb-md"},fe=$({__name:"ClientDineInCashPaymentModal",props:{orderId:{},modelValue:{type:Boolean}},emits:["close","update:modelValue"],setup(_,{emit:c}){const r=_,n=Q(()=>r.modelValue),o=c,d=T(),m=P(),s=C(!1),a=C(!1);return A(n,()=>{!n.value||(s.value=!0,d.commit.sync(z({orderId:r.orderId})).then(()=>{a.value=!0}).catch(()=>{a.value=!1}).finally(()=>{s.value=!1}))},{immediate:!0}),(u,b)=>(i(),y(M,{"model-value":n.value,"onUpdate:modelValue":b[0]||(b[0]=k=>o("update:modelValue",k))},{default:t(()=>[e(N,{class:"dialog-sm q-pb-md q-px-md"},{default:t(()=>[e(f,{class:"row items-center q-pb-none"},{default:t(()=>[e(I),h(e(g,{icon:"close",flat:"",round:"",dense:""},null,512),[[x]])]),_:1}),s.value?(i(),y(D,{key:0})):a.value?(i(),y(f,{key:1},{default:t(()=>[v("div",ie,[v("p",ce,p(l(m).waiterWasCalled),1),v("p",pe,p(l(m).waiterWillAcceptPayment),1),h(e(g,{label:l(m).ok,color:"primary",class:"q-mx-auto d-block"},null,8,["label"]),[[x]])])]),_:1})):V("",!0)]),_:1})]),_:1},8,["model-value"]))}}),ve={class:"text-center"},ye={class:"text-h5 q-mb-lg"},_e=$({__name:"ClientTakeoutDeliveryCashPaymentModal",props:{modelValue:{type:Boolean}},emits:["close","update:modelValue"],setup(_,{emit:c}){const r=_,n=Q(()=>r.modelValue),o=c,d=P();return(m,s)=>(i(),y(M,{"model-value":n.value,"onUpdate:modelValue":s[0]||(s[0]=a=>o("update:modelValue",a))},{default:t(()=>[e(N,{class:"dialog-sm q-pb-md q-px-md"},{default:t(()=>[e(f,{class:"row items-center q-pb-none"},{default:t(()=>[e(I),h(e(g,{icon:"close",flat:"",round:"",dense:""},null,512),[[x]])]),_:1}),e(f,null,{default:t(()=>[v("div",ve,[v("p",ye,p(l(d).payInCashUponReceipt),1),h(e(g,{label:l(d).ok,color:"primary",class:"q-mx-auto d-block"},null,8,["label"]),[[x]])])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),be={key:0,class:"text-h4 text-center q-mb-md"},Ce={key:1},he=$({__name:"PaymentCard",props:{orderNumber:{},method:{}},setup(_){const c=_,r=P(),n=C(!1),o=T(),d=Q(()=>o.state.orders.paymentLink),m=C(),s=Q(()=>{var u;return(u=o.state.auth.user.permissions)==null?void 0:u.client});F(async()=>{var u,b;(u=m.value)==null||u.replaceChildren(),n.value=!0;try{if(await a(),W("paymentLink:",d.value),H(d.value,"payment link was not received"),s.value)window.open(d.value,"_self");else try{const k=await le.toCanvas(d.value,{errorCorrectionLevel:"M",version:14,width:280});(b=m.value)==null||b.appendChild(k)}catch(k){Y("QR code generation error:",k)}}finally{n.value=!1}});async function a(){return await o.commit.sync(j({orderNumber:c.orderNumber,method:c.method}))}return(u,b)=>(i(),q(O,null,[e(f,null,{default:t(()=>[n.value?V("",!0):(i(),q("p",be,p(s.value?l(r).clickToPay:l(r).scanQrCode),1))]),_:1}),e(f,null,{default:t(()=>[n.value?(i(),y(D,{key:0})):V("",!0),v("div",{ref_key:"qrCodeContainer",ref:m,class:"w-fit q-mx-auto"},null,512),!n.value&&s.value?(i(),q("div",Ce,[e(g,{color:"primary",class:"q-mx-auto d-block w-fit",href:d.value},{default:t(()=>[w(p(l(r).pay),1)]),_:1},8,["href"])])):V("",!0)]),_:1})],64))}}),ge=$({__name:"CreditCardOrBlikPaymentModal",props:{orderNumber:{},modelValue:{type:Boolean},method:{}},emits:["update:modelValue"],setup(_,{emit:c}){const r=_,n=c,o=Q(()=>r.modelValue);return(d,m)=>(i(),y(M,{maximized:"","model-value":o.value,"onUpdate:modelValue":m[0]||(m[0]=s=>n("update:modelValue",s))},{default:t(()=>[e(N,{class:"q-pb-sm"},{default:t(()=>[e(f,{class:"row items-center q-pb-none"},{default:t(()=>[e(I),h(e(g,{icon:"close",flat:"",round:"",dense:"",size:"lg"},null,512),[[x]])]),_:1}),o.value?(i(),y(he,{key:0,"order-number":d.orderNumber,method:d.method},null,8,["order-number","method"])):V("",!0)]),_:1})]),_:1},8,["model-value"]))}}),B=$({__name:"PaymentMethodCard",props:{imageSrc:{}},emits:["click"],setup(_,{emit:c}){const r=c;return P(),(n,o)=>(i(),q("div",null,[e(ne,{bordered:"",separator:"",class:"rounded-borders"},{default:t(()=>[h((i(),y(re,{clickable:"",class:"q-px-md q-py-sm",onClick:o[0]||(o[0]=d=>r("click"))},{default:t(()=>[e(L,{avatar:"",class:"q-mr-xs"},{default:t(()=>[e(oe,{src:n.imageSrc,alt:"",fit:"contain",class:"image-xs-sm"},null,8,["src"])]),_:1}),e(L,null,{default:t(()=>[e(se,{class:"text-weight-bold text-h6"},{default:t(()=>[G(n.$slots,"text")]),_:3})]),_:3})]),_:3})),[[K],[x]])]),_:3})]))}}),ke={class:"text-h5 text-center"},Ve={class:"text-h5"},xe={class:"text-primary"},qe={class:"text-h5"},we={key:0,class:"text-primary"},Qe={key:1},$e=$({__name:"WaiterCashPaymentModal",props:{totalCost:{},orderNumber:{}},emits:["close","paid"],setup(_,{emit:c}){const r=_,n=c,o=P(),d=C(""),m=Q(()=>Math.max(R(+d.value)-r.totalCost,0)),s=C(!1),a=T();async function u(){s.value=!0,a.commit.sync(X({orderNumber:r.orderNumber})).then(()=>{Z.create({type:"positive",position:"top",timeout:ee,message:o.value.paymentSuccess,multiLine:!0,group:!1}),n("close"),n("paid")}).finally(()=>{s.value=!1})}return(b,k)=>(i(),y(M,null,{default:t(()=>[e(N,{class:"dialog-sm q-pb-md q-px-md"},{default:t(()=>[e(f,{class:"row items-center q-pb-none"},{default:t(()=>[e(I),h(e(g,{icon:"close",flat:"",round:"",dense:""},null,512),[[x]])]),_:1}),e(f,null,{default:t(()=>[v("p",ke,p(l(o).payWithCash),1)]),_:1}),e(f,null,{default:t(()=>[v("p",Ve,[w(p(l(o).totalToPay)+": ",1),v("span",xe,p(l(U)(b.totalCost)),1)])]),_:1}),e(de,{onSubmit:u,onValidationError:l(me)},{default:t(()=>[e(f,null,{default:t(()=>[e(ue,{modelValue:d.value,"onUpdate:modelValue":k[0]||(k[0]=S=>d.value=S),modelModifiers:{number:!0},"stack-label":"",label:`${l(o).amount} *`,hint:l(o).amountHint,"lazy-rules":"",type:"number",step:"0.01",rules:[S=>S!==""||l(o).fieldRequired,S=>l(R)(S)>=b.totalCost||l(o).minValue({min:l(U)(b.totalCost)})]},null,8,["modelValue","label","hint","rules"])]),_:1}),e(f,null,{default:t(()=>[v("p",qe,[w(p(l(o).change)+": ",1),m.value>0?(i(),q("span",we,p(l(U)(m.value)),1)):(i(),q("span",Qe,"-"))]),h(v("p",{class:"text-caption text-negative q-mt-xs"},p(l(o).makeSureChangeGiven),513),[[J,m.value>0]])]),_:1}),e(f,{align:"center"},{default:t(()=>[e(g,{color:"primary",type:"submit",class:"q-px-lg",loading:s.value},{default:t(()=>[w(p(l(o).pay),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["onValidationError"])]),_:1})]),_:1}))}}),Pe={class:"text-h5 text-center"},Fe=$({__name:"PaymentMethodsModal",props:{totalCost:{},orderNumber:{},orderId:{},orderType:{}},setup(_){const c=P(),r=C(!1),n=C(!1),o=C("card"),d=T(),m=Q(()=>{var s;return(s=d.state.auth.user.permissions)==null?void 0:s.client});return(s,a)=>(i(),q(O,null,[e(M,te(ae(s.$attrs)),{default:t(()=>[e(N,{class:"dialog-sm q-pb-md q-px-md"},{default:t(()=>[e(f,{class:"row items-center q-pb-none"},{default:t(()=>[e(I),h(e(g,{icon:"close",flat:"",round:"",dense:""},null,512),[[x]])]),_:1}),e(f,null,{default:t(()=>[v("p",Pe,p(l(c).selectPaymentMethod),1)]),_:1}),e(f,null,{default:t(()=>[e(B,{"image-src":"~assets/cash.svg",onClick:a[0]||(a[0]=u=>r.value=!0)},{text:t(()=>[w(p(l(c).cash),1)]),_:1}),e(B,{class:"q-mt-lg","image-src":"~assets/credit-card.svg",onClick:a[1]||(a[1]=u=>{o.value="card",n.value=!0})},{text:t(()=>[w(p(l(c).creditCard),1)]),_:1}),e(B,{class:"q-mt-lg","image-src":"~assets/blik.png",onClick:a[2]||(a[2]=u=>{o.value="blik",n.value=!0})},{text:t(()=>[w(p(l(c).blik),1)]),_:1})]),_:1})]),_:1})]),_:1},16),m.value?V("",!0):(i(),y($e,{key:0,modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=u=>r.value=u),onClose:a[4]||(a[4]=u=>r.value=!1),"total-cost":s.totalCost,"order-number":s.orderNumber},null,8,["modelValue","total-cost","order-number"])),m.value&&s.orderType===l(E).DINE_IN?(i(),y(fe,{key:1,modelValue:r.value,"onUpdate:modelValue":a[5]||(a[5]=u=>r.value=u),onClose:a[6]||(a[6]=u=>r.value=!1),"order-id":s.orderId},null,8,["modelValue","order-id"])):V("",!0),m.value&&(s.orderType===l(E).TAKEOUT||s.orderType===l(E).DELIVERY)?(i(),y(_e,{key:2,modelValue:r.value,"onUpdate:modelValue":a[7]||(a[7]=u=>r.value=u),onClose:a[8]||(a[8]=u=>r.value=!1)},null,8,["modelValue"])):V("",!0),e(ge,{modelValue:n.value,"onUpdate:modelValue":a[9]||(a[9]=u=>n.value=u),"order-number":s.orderNumber,method:o.value},null,8,["modelValue","order-number","method"])],64))}});export{Fe as _,$e as a};
