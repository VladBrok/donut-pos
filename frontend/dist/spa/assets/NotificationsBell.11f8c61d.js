import{Q as M}from"./QTooltip.64d8fdeb.js";import{d as F,u as Z,a as J,r as T,h as c,o as d,i as N,j as v,t as m,g as e,k as n,w as i,n as w,ag as I,e as h,bV as Pe,f as _,p as Ae,q as g,a4 as Ye,H as X,bW as Ge,bX as He,ay as A,c as We,ae as je,ai as ge,aG as Xe,az as he,b7 as Ke,bY as Ce,bZ as Ze,b_ as G,b$ as Je,c0 as et,c1 as Oe,c2 as tt,Q as Te,b2 as at,b3 as rt,c3 as ot,bD as ke,c4 as lt,c5 as st,c6 as Ne,ah as nt,c7 as it,c8 as ut,c9 as dt,ca as ct,as as mt,at as vt,cb as pt,m as ft}from"./index.3f3b8c57.js";import{g as bt,b as yt}from"./get-order-total-cost.0ab55512.js";import{_ as xe}from"./OrderNumberTitle.bf4db84c.js";import{_ as _t}from"./PaymentMethodsModal.49b92ce9.js";import{m as gt,f as Q}from"./address.94d37a80.js";import{g as K}from"./CommonFooter.a74657d3.js";import{a as H,Q as B,b as ht}from"./QItemLabel.b85da9a3.js";import{Q as W}from"./QSelect.dcdd87e0.js";import{Q as Ie}from"./QInput.af205288.js";import{Q as Ct,_ as Ee}from"./NoData.f3f3f67f.js";import{Q as Ot}from"./QImg.bc00f4b6.js";import{Q as Tt,o as kt}from"./on-form-validation-error.a634981b.js";import{u as Nt,C as j,B as It}from"./BigSpinner.f02a38f1.js";import{_ as St}from"./AddAddressModal.1b9f025f.js";import{g as wt,_ as At}from"./get-order-type-icon.c0a167f8.js";import{_ as xt}from"./OrderView.fe1bc0bf.js";import{_ as Et}from"./PhoneInput.e5cc4833.js";import{u as Dt}from"./useIsLoggedIn.876d5ddb.js";import{c as Rt}from"./create-order.7182eabd.js";import{c as Se}from"./fuzzy-search.950e6fed.js";import{_ as we}from"./ConfirmDialog.7d9f2db6.js";import{Q as Vt}from"./QMenu.5622cc90.js";const qt={class:"row no-wrap gap-md q-py-md q-px-xs items-center"},$t={class:"flex-grow"},Lt={class:"text-body2"},Bt={class:"text-subtitle1 text-weight-bold q-mb-xs"},Qt={key:0,class:"text-body2 q-mt-xs row no-wrap items-center gap-sm"},Mt={class:"text-weight-bold"},Ft={class:"q-mt-md row gap-sm justify-between"},Ut={key:1},zt={class:"text-body2 q-mb-sm"},Na=F({__name:"CookedOrderNotification",props:{order:{}},setup(u){const l=u,t=Z(),s=J(),f=T(!1),S=T(!1),x=c(()=>s.state.salePoints.defaultSalePoint),k=c(()=>{var p;return(p=s.state.auth.user.permissions)==null?void 0:p.client});function q(){var p,C;(C=window==null?void 0:window.open(`http://www.google.com/maps/place?q=${gt((p=x.value)==null?void 0:p.address)}`,"_blank"))==null||C.focus()}function U(){S.value=!0,s.commit.sync(Pe({orderId:l.order.order.id,isEmployee:!k.value})).finally(()=>{S.value=!1})}return(p,C)=>(d(),N("div",qt,[v("div",$t,[v("div",Lt,[v("p",Bt,m(k.value?e(t).clientOrderReady:e(t).employeeOrderReady),1),n(xe,{"order-number":p.order.order.orderNumber,"is-link":""},null,8,["order-number"]),x.value&&k.value?(d(),N("div",Qt,[v("div",null,[v("p",null,m(e(t).pickOrderUp),1),v("p",Mt,m(e(Q)(x.value.address)),1)]),n(w,{round:"",dense:"",icon:"location_on",color:"primary",size:"md",onClick:q},{default:i(()=>[n(M,null,{default:i(()=>[_(m(e(t).showOnMap),1)]),_:1})]),_:1})])):I("",!0)]),v("div",null,[v("div",Ft,[p.order.order.paidDate?(d(),N("div",Ut,[v("p",zt,m(k.value?e(t).orderReceiveInstruction:e(t).takeoutOrderDeliverInstruction),1),n(w,{color:"primary",onClick:U,loading:S.value},{default:i(()=>[_(m(k.value?e(t).confirmOrderReceived:e(t).delivered),1)]),_:1},8,["loading"])])):(d(),h(w,{key:0,color:"primary",onClick:C[0]||(C[0]=D=>f.value=!0)},{default:i(()=>[_(m(e(t).pay),1)]),_:1}))])])]),n(_t,{modelValue:f.value,"onUpdate:modelValue":C[1]||(C[1]=D=>f.value=D),"order-number":p.order.order.orderNumber,"order-id":p.order.order.id,"order-type":p.order.order.type,"total-cost":e(bt)(p.order.order)},null,8,["modelValue","order-number","order-id","order-type","total-cost"])]))}}),Pt=["top","middle","bottom"];var De=Ae({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:u=>Pt.includes(u)}},setup(u,{slots:l}){const t=c(()=>u.align!==void 0?{verticalAlign:u.align}:null),s=c(()=>{const f=u.outline===!0&&u.color||u.textColor;return`q-badge flex inline items-center no-wrap q-badge--${u.multiLine===!0?"multi":"single"}-line`+(u.outline===!0?" q-badge--outline":u.color!==void 0?` bg-${u.color}`:"")+(f!==void 0?` text-${f}`:"")+(u.floating===!0?" q-badge--floating":"")+(u.rounded===!0?" q-badge--rounded":"")+(u.transparent===!0?" q-badge--transparent":"")});return()=>g("div",{class:s.value,style:t.value,role:"status","aria-label":u.label},Ye(l.default,u.label!==void 0?[u.label]:[]))}});const Ia=F({__name:"CurrentOrderDishesBadge",setup(u){const l=J(),t=c(()=>l.state.currentOrder.order),s=T("");return X(()=>K(t.value),()=>{const f=K(t.value);setTimeout(()=>{s.value=f||""},Ge)},{immediate:!0}),(f,S)=>t.value?(d(),h(De,{key:0,rounded:"",floating:"",color:"red",label:s.value},null,8,["label"])):I("",!0)}}),Yt={key:1},Gt={key:0},Ht={class:"row justify-end q-gutter-sm"},Wt={class:"q-mt-xl"},jt={key:0,class:"column justify-center items-center"},Xt={class:"text-h6"},Kt={class:"row no-wrap"},Sa=F({__name:"CurrentOrderView",setup(u){const l=J(),t=c(()=>l.state.currentOrder.order),s=Z(),f=T(!1),S=T(!1),x=T(!1),k=T(!1),q=c(()=>l.state.auth.user.userId),U=c(()=>q.value===Xe.userId?[j.DINING_TABLES]:[j.DINING_TABLES,j.ADDRESSES_OF_CLIENT(q.value)]),p=c(()=>{var o;return(o=l.state.auth.user.permissions)==null?void 0:o.client}),C=c(()=>{var o,a;return((o=t.value)==null?void 0:o.address)&&!t.value.address.id?[...l.state.addresses.addresses,(a=t.value)==null?void 0:a.address]:l.state.addresses.addresses}),D=T(""),Re=c(()=>Se(C.value,["city","homeNumber","postalCode","street"])),Ve=c(()=>Re.value.search(D.value).map(o=>Q(o))),ee=T(""),qe=c(()=>Se(l.state.diningTables.tables,["number"])),$e=c(()=>qe.value.search(ee.value).map(o=>o.number)),$=Nt(U,{store:l}),te=c(()=>l.state.diningTables.tables),ae=c(()=>l.state.currentOrder.previous),z=c(()=>{var o;return $.value?[]:(o=t.value)==null?void 0:o.dishes.map(a=>({dish:a,count:a.count,modifications:a.modifications,totalCost:yt({count:a.count,price:a.price,modifications:a.modifications.map(O=>({count:O.count,price:O.price}))})}))}),P=c(()=>{var o;return((o=z.value)==null?void 0:o.some(a=>!a.dish.isActive))||!1}),re=c(()=>{var o;return((o=z.value)==null?void 0:o.reduce((a,O)=>a+O.totalCost,0))||0}),Le=c(()=>{var o;return re.value+(((o=t.value)==null?void 0:o.type)===A.DELIVERY?he:0)}),R=T(!1),L=He(),V=c(()=>Ke.map(o=>({label:s.value[`orderType_${o}`],value:o,icon:wt(o)}))),Y=T(L.query.table?V.value.find(o=>o.value===A.DINE_IN):V.value.find(o=>o.value===A.TAKEOUT)),Be=We(),Qe=Dt(),oe=c(()=>{var o;return((o=t.value)==null?void 0:o.type)===A.DELIVERY&&!t.value.address}),Me=X($,()=>{$.value||(L.query.table&&l.commit.crossTab(Ce({table:te.value.find(o=>{var a,O;return o.number===((O=(a=L.query.table)==null?void 0:a.toString())==null?void 0:O.trim())})||null})),Me())},{immediate:!0});X(t,(o,a)=>{var O;o&&!a&&l.commit.crossTab(Ze({order:void 0})),t.value&&C.value.length&&!((O=t.value)!=null&&O.address)&&l.commit.crossTab(G({address:C.value[0]}))},{immediate:!0});const Fe=(o,a)=>{a(()=>{ee.value=o})},Ue=(o,a)=>{a(()=>{D.value=o})};function ze(){l.commit.crossTab(ct()),f.value=!1}async function le(){var o,a;if(!Qe.value){l.commit.crossTab(Je({value:!0})),Be.push(`/sign-up?text=${et}`);return}x.value=!0;try{if((o=t.value)!=null&&o.type||await l.commit.crossTab(Oe({type:Y.value.value})),((a=t.value)==null?void 0:a.type)===A.DINE_IN&&t.value.table&&!p.value&&!S.value){if(await l.commit.sync(tt({tableId:t.value.table.id})),l.state.orders.tableTakenByOrderNumber){k.value=!0;return}}else S.value&&(S.value=!1);await Rt(l,s)}finally{x.value=!1}}return(o,a)=>{const O=je("RouterLink");return d(),N(ge,null,[n(Tt,{onSubmit:le,onValidationError:e(kt)},{default:i(()=>{var b;return[n(xt,{"has-content":Boolean(t.value),"dish-count":e(K)(t.value),"total-cost":Le.value,"delivery-cost":e(he),"dish-cost":re.value,"order-type":(b=t.value)==null?void 0:b.type,"custom-empty":""},{content:i(()=>{var E,se,ne,ie,ue,de,ce,me,ve,pe,fe,be,ye;return[e($)?(d(),h(It,{key:0})):(d(),N("div",Yt,[v("div",null,[n(W,{"model-value":V.value.find(r=>{var y;return r.value===((y=t.value)==null?void 0:y.type)})||Y.value,"onUpdate:modelValue":a[0]||(a[0]=r=>e(l).commit.crossTab(e(Oe)({type:r.value}))),"stack-label":"",options:V.value,label:e(s).orderTypeLabel,class:"q-mb-md"},{before:i(()=>{var r;return[n(Te,{name:(r=V.value.find(y=>{var _e;return y.value===(((_e=t.value)==null?void 0:_e.type)||Y.value.value)}))==null?void 0:r.icon},null,8,["name"])]}),option:i(r=>[n(H,at(rt(r.itemProps)),{default:i(()=>[n(B,{avatar:""},{default:i(()=>[n(Te,{name:r.opt.icon},null,8,["name"])]),_:2},1024),n(B,null,{default:i(()=>[n(ht,null,{default:i(()=>[_(m(r.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["model-value","options","label"]),((E=t.value)==null?void 0:E.type)===e(A).DELIVERY?(d(),N("div",Gt,[n(W,{"model-value":e(Q)(t.value.address),"onUpdate:modelValue":a[2]||(a[2]=r=>e(l).commit.crossTab(e(G)({address:C.value.find(y=>e(Q)(y)===r)}))),"use-input":"","fill-input":"","stack-label":"","hide-selected":"",clearable:"","input-debounce":"0",options:Ve.value,onFilter:Ue,label:`${e(s).deliveryAddress} *`,rules:[r=>!!r&&r.length>0||e(s).fieldRequired]},{after:i(()=>[n(w,{round:"",dense:"",icon:"add",color:"primary",onClick:a[1]||(a[1]=r=>R.value=!0)},{default:i(()=>[n(M,null,{default:i(()=>[_(m(e(s).addNewDeliveryAddress),1)]),_:1})]),_:1})]),"no-option":i(()=>[n(H,null,{default:i(()=>[n(B,null,{default:i(()=>[_(m(e(s).noResults),1)]),_:1})]),_:1})]),_:1},8,["model-value","options","label","rules"])])):I("",!0),!p.value&&((se=t.value)==null?void 0:se.type)===e(A).DELIVERY?(d(),h(Ie,{key:1,"model-value":(ie=(ne=t.value)==null?void 0:ne.client)==null?void 0:ie.firstName,"onUpdate:modelValue":a[3]||(a[3]=r=>e(l).commit.crossTab(e(ot)({firstName:(r==null?void 0:r.toString())||""}))),"stack-label":"",label:`${e(s).clientFirstName} *`,"lazy-rules":"",type:"text",rules:[r=>!!r&&r.length>0||e(s).fieldRequired,r=>r.length<=e(ke)||e(s).maxLength({max:e(ke)})]},null,8,["model-value","label","rules"])):I("",!0),!p.value&&((ue=t.value)==null?void 0:ue.type)==="delivery"?(d(),h(Et,{key:2,"model-value":((ce=(de=t.value)==null?void 0:de.client)==null?void 0:ce.phone)||"","onUpdate:modelValue":a[4]||(a[4]=r=>e(l).commit.crossTab(e(lt)({phone:r}))),shouldValidateFormat:""},null,8,["model-value"])):I("",!0),((me=t.value)==null?void 0:me.type)===e(A).DINE_IN?(d(),h(W,{key:3,"model-value":(pe=(ve=t.value)==null?void 0:ve.table)==null?void 0:pe.number,"onUpdate:modelValue":a[5]||(a[5]=r=>e(l).commit.crossTab(e(Ce)({table:te.value.find(y=>y.number===(r==null?void 0:r.trim()))||null}))),"use-input":"","fill-input":"","stack-label":"",clearable:"","hide-selected":"","input-debounce":"0",disable:!!e(L).query.table&&!!((be=(fe=t.value)==null?void 0:fe.table)!=null&&be.number),options:$e.value,onFilter:Fe,label:`${e(s).tableNumberLabel} *`,rules:[r=>!!r&&r.length>0||e(s).fieldRequired]},{"no-option":i(()=>[n(H,null,{default:i(()=>[n(B,null,{default:i(()=>[_(m(e(s).noResults),1)]),_:1})]),_:1})]),_:1},8,["model-value","disable","options","label","rules"])):I("",!0),n(Ie,{"model-value":(ye=t.value)==null?void 0:ye.comment,"onUpdate:modelValue":a[6]||(a[6]=r=>e(l).commit.crossTab(e(st)({comment:(r==null?void 0:r.toString())||""}))),"stack-label":"",label:`${e(s).commentLabel}`,"lazy-rules":"",type:"textarea",rows:"1",autogrow:"",rules:[r=>!r||r.length<=e(Ne)||e(s).maxLength({max:e(Ne)})]},null,8,["model-value","label","rules"])]),v("div",null,[(d(!0),N(ge,null,nt(z.value,r=>(d(),N("div",{key:r.dish.dishIdInOrder},[n(At,{dish:r.dish,count:r.count,"total-cost":r.totalCost,modifications:r.modifications.map(y=>({count:y.count,modification:y})),onDelete:y=>e(l).commit.crossTab(e(it)({dishIdInOrder:r.dish.dishIdInOrder})),onIncrement:y=>e(l).commit.crossTab(e(ut)({dish:r.dish})),onDecrement:y=>e(l).commit.crossTab(e(dt)({dish:{id:r.dish.id,modifications:r.dish.modifications}}))},null,8,["dish","count","total-cost","modifications","onDelete","onIncrement","onDecrement"]),n(Ct)]))),128))])]))]}),options:i(()=>[v("div",Ht,[n(w,{color:"negative",flat:"",onClick:a[7]||(a[7]=E=>f.value=!0),type:"button"},{default:i(()=>[_(m(e(s).clearOrder),1)]),_:1}),n(w,{color:"primary",type:"submit",loading:x.value,disable:P.value||oe.value},{default:i(()=>[_(m(e(s).createOrder)+" ",1),P.value||oe.value?(d(),h(M,{key:0,class:"bg-negative text-white text-body1","max-width":"200px"},{default:i(()=>[_(m(P.value?e(s).cannotCreateOrderWithOutOfStock:e(s).specifyDeliveryAddress),1)]),_:1})):I("",!0)]),_:1},8,["loading","disable"])])]),empty:i(()=>[v("div",Wt,[ae.value?(d(),N("div",jt,[n(Ot,{src:"/images/cart.svg",alt:"",fit:"cover",class:"image-md"}),v("p",Xt,m(e(s).orderWasCreated)+"!",1),n(O,{class:"text-body1 q-mt-sm",to:`/orders/${ae.value.orderNumber}`},{default:i(()=>[_(m(e(s).viewOrder),1)]),_:1},8,["to"])])):(d(),h(Ee,{key:1,text:e(s).emptyOrder},null,8,["text"]))])]),_:1},8,["has-content","dish-count","total-cost","delivery-cost","dish-cost","order-type"])]}),_:1},8,["onValidationError"]),n(we,{modelValue:f.value,"onUpdate:modelValue":a[8]||(a[8]=b=>f.value=b)},{body:i(()=>[_(m(e(s).confirmCurrentOrderClear)+"? ",1)]),confirmButton:i(()=>[n(w,{flat:"",label:e(s).clearOrder,color:"negative",onClick:ze},null,8,["label"])]),_:1},8,["modelValue"]),R.value?(d(),h(St,{key:0,modelValue:R.value,"onUpdate:modelValue":a[9]||(a[9]=b=>R.value=b),onSubmit:a[10]||(a[10]=b=>(R.value=!1,e(l).commit.crossTab(e(G)({address:b}))))},null,8,["modelValue"])):I("",!0),n(we,{modelValue:k.value,"onUpdate:modelValue":a[12]||(a[12]=b=>k.value=b)},{body:i(()=>{var b,E;return[v("div",Kt,[v("div",null,m(e(s).confirmOrderWithTakenTableCreate1({tableNumber:((E=(b=t.value)==null?void 0:b.table)==null?void 0:E.number)||""})),1),_(" \xA0 "),n(xe,{orderNumber:e(l).state.orders.tableTakenByOrderNumber||"","is-link":""},null,8,["orderNumber"])]),v("div",null,m(e(s).confirmOrderWithTakenTableCreate2),1)]}),confirmButton:i(()=>[n(w,{flat:"",label:e(s).createOrder,color:"primary",onClick:a[11]||(a[11]=b=>(S.value=!0,k.value=!1,le()))},null,8,["label"])]),_:1},8,["modelValue"])],64)}}}),Zt=[g("g",{fill:"none","fill-rule":"evenodd",transform:"translate(1 1)","stroke-width":"2"},[g("circle",{cx:"22",cy:"22",r:"6"},[g("animate",{attributeName:"r",begin:"1.5s",dur:"3s",values:"6;22",calcMode:"linear",repeatCount:"indefinite"}),g("animate",{attributeName:"stroke-opacity",begin:"1.5s",dur:"3s",values:"1;0",calcMode:"linear",repeatCount:"indefinite"}),g("animate",{attributeName:"stroke-width",begin:"1.5s",dur:"3s",values:"2;0",calcMode:"linear",repeatCount:"indefinite"})]),g("circle",{cx:"22",cy:"22",r:"6"},[g("animate",{attributeName:"r",begin:"3s",dur:"3s",values:"6;22",calcMode:"linear",repeatCount:"indefinite"}),g("animate",{attributeName:"stroke-opacity",begin:"3s",dur:"3s",values:"1;0",calcMode:"linear",repeatCount:"indefinite"}),g("animate",{attributeName:"stroke-width",begin:"3s",dur:"3s",values:"2;0",calcMode:"linear",repeatCount:"indefinite"})]),g("circle",{cx:"22",cy:"22",r:"8"},[g("animate",{attributeName:"r",begin:"0s",dur:"1.5s",values:"6;1;2;3;4;5;6",calcMode:"linear",repeatCount:"indefinite"})])])];var Jt=Ae({name:"QSpinnerRings",props:mt,setup(u){const{cSize:l,classes:t}=vt(u);return()=>g("svg",{class:t.value,stroke:"currentColor",width:l.value,height:l.value,viewBox:"0 0 45 45",xmlns:"http://www.w3.org/2000/svg"},Zt)}});const ea={class:"q-px-xs",style:{"min-width":"300px"}},ta={key:0},wa=F({__name:"NotificationsBell",props:{isLoading:{type:Boolean},notificationCount:{}},setup(u){const l=Z();return(t,s)=>(d(),h(w,{class:"q-mr-xs",flat:"",round:"",icon:"o_notifications"},{default:i(()=>[n(M,null,{default:i(()=>[_(m(e(l).showNotifications),1)]),_:1}),t.isLoading?(d(),h(Jt,{key:0,color:"primary",size:"40px",class:"absolute-top-right-offset"})):I("",!0),t.notificationCount?(d(),h(De,{key:1,rounded:"",floating:"",color:"red",label:t.notificationCount||""},null,8,["label"])):I("",!0),n(Vt,{fit:"",style:{"overflow-x":"hidden","min-width":"300px"}},{default:i(()=>[v("div",ea,[n(pt,{tag:"div",name:"fade",style:{"min-width":"300px"}},{default:i(()=>[t.notificationCount?ft(t.$slots,"notification-list",{key:1}):(d(),N("p",ta,[(d(),h(Ee,{key:"empty",text:e(l).noNotifications,class:"q-py-lg"},null,8,["text"]))]))]),_:3})])]),_:3})]),_:3}))}});export{Na as _,wa as a,Ia as b,Sa as c};
